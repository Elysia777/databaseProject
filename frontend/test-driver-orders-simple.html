<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸æœºè®¢å•æŸ¥è¯¢æµ‹è¯•ï¼ˆç®€åŒ–ç‰ˆï¼‰</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e4e7ed;
            border-radius: 8px;
        }
        .test-title {
            font-size: 18px;
            font-weight: 600;
            color: #303133;
            margin-bottom: 16px;
        }
        .test-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .test-result {
            background: #f8f9fa;
            border-radius: 4px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #67c23a; }
        .error { color: #f56c6c; }
        .info { color: #409eff; }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <h1>å¸æœºè®¢å•æŸ¥è¯¢æµ‹è¯•ï¼ˆç®€åŒ–ç‰ˆï¼‰</h1>
            
            <!-- åŸºç¡€æŸ¥è¯¢æµ‹è¯• -->
            <div class="test-section">
                <div class="test-title">1. åŸºç¡€è®¢å•æŸ¥è¯¢</div>
                <div class="test-controls">
                    <el-input v-model="driverId" placeholder="å¸æœºID" style="width: 120px;"></el-input>
                    <el-button @click="testBasicQuery" type="primary">åŸºç¡€æŸ¥è¯¢</el-button>
                </div>
                <div class="test-result">{{ basicResult }}</div>
            </div>

            <!-- çŠ¶æ€ç­›é€‰æµ‹è¯• -->
            <div class="test-section">
                <div class="test-title">2. çŠ¶æ€ç­›é€‰æŸ¥è¯¢</div>
                <div class="test-controls">
                    <el-select v-model="statusFilter" placeholder="é€‰æ‹©çŠ¶æ€" style="width: 150px;">
                        <el-option label="å·²å®Œæˆ" value="COMPLETED"></el-option>
                        <el-option label="å·²å–æ¶ˆ" value="CANCELLED"></el-option>
                        <el-option label="è¿›è¡Œä¸­" value="IN_PROGRESS"></el-option>
                        <el-option label="å·²æ¥å•" value="ASSIGNED"></el-option>
                    </el-select>
                    <el-button @click="testStatusFilter" type="primary">çŠ¶æ€ç­›é€‰</el-button>
                </div>
                <div class="test-result">{{ statusResult }}</div>
            </div>

            <!-- æ—¥æœŸèŒƒå›´æŸ¥è¯¢æµ‹è¯• -->
            <div class="test-section">
                <div class="test-title">3. æ—¥æœŸèŒƒå›´æŸ¥è¯¢</div>
                <div class="test-controls">
                    <el-date-picker
                        v-model="dateRange"
                        type="daterange"
                        range-separator="è‡³"
                        start-placeholder="å¼€å§‹æ—¥æœŸ"
                        end-placeholder="ç»“æŸæ—¥æœŸ"
                        format="YYYY-MM-DD"
                        value-format="YYYY-MM-DD"
                        style="width: 300px;">
                    </el-date-picker>
                    <el-button @click="testDateRange" type="primary">æ—¥æœŸæŸ¥è¯¢</el-button>
                </div>
                <div class="test-result">{{ dateResult }}</div>
            </div>

            <!-- åˆ†é¡µæµ‹è¯• -->
            <div class="test-section">
                <div class="test-title">4. åˆ†é¡µæµ‹è¯•</div>
                <div class="test-controls">
                    <el-input-number v-model="pageSize" :min="5" :max="50" style="width: 120px;"></el-input-number>
                    <span>æ¯é¡µæ¡æ•°</span>
                    <el-button @click="testPagination" type="primary">åˆ†é¡µæµ‹è¯•</el-button>
                </div>
                <div class="test-result">{{ paginationResult }}</div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <script>
        const { createApp, ref } = Vue;
        
        createApp({
            setup() {
                // æµ‹è¯•æ•°æ®
                const driverId = ref('1');
                const statusFilter = ref('');
                const dateRange = ref(null);
                const pageSize = ref(10);
                
                // æµ‹è¯•ç»“æœ
                const basicResult = ref('ç­‰å¾…æµ‹è¯•...');
                const statusResult = ref('ç­‰å¾…æµ‹è¯•...');
                const dateResult = ref('ç­‰å¾…æµ‹è¯•...');
                const paginationResult = ref('ç­‰å¾…æµ‹è¯•...');

                // é€šç”¨è¯·æ±‚å‡½æ•°
                const makeRequest = async (params = {}) => {
                    try {
                        const url = new URL(`/api/drivers/${driverId.value}/orders`, window.location.origin);
                        Object.keys(params).forEach(key => {
                            if (params[key] !== null && params[key] !== undefined && params[key] !== '') {
                                url.searchParams.append(key, params[key]);
                            }
                        });

                        console.log('è¯·æ±‚URL:', url.toString());
                        
                        const response = await fetch(url);
                        const result = await response.json();
                        
                        return {
                            success: result.code === 200,
                            data: result.data,
                            message: result.message,
                            url: url.toString()
                        };
                    } catch (error) {
                        return {
                            success: false,
                            error: error.message,
                            url: 'è¯·æ±‚å¤±è´¥'
                        };
                    }
                };

                // æ ¼å¼åŒ–ç»“æœ
                const formatResult = (result) => {
                    if (!result.success) {
                        return `âŒ è¯·æ±‚å¤±è´¥: ${result.error || result.message}\nè¯·æ±‚URL: ${result.url}`;
                    }
                    
                    const data = result.data;
                    let output = `âœ… è¯·æ±‚æˆåŠŸ\nè¯·æ±‚URL: ${result.url}\n\n`;
                    
                    if (Array.isArray(data)) {
                        output += `ğŸ“‹ æŸ¥è¯¢åˆ° ${data.length} æ¡è®°å½•\n\n`;
                        
                        if (data.length > 0) {
                            // ç»Ÿè®¡ä¿¡æ¯
                            const completed = data.filter(order => order.status === 'COMPLETED').length;
                            const totalEarnings = data
                                .filter(order => order.status === 'COMPLETED')
                                .reduce((sum, order) => sum + (parseFloat(order.actualFare || order.estimatedFare || 0)), 0);
                            
                            output += `ğŸ“Š ç»Ÿè®¡ä¿¡æ¯:\n`;
                            output += `- å·²å®Œæˆè®¢å•: ${completed}\n`;
                            output += `- æ€»æ”¶å…¥: Â¥${totalEarnings.toFixed(2)}\n\n`;
                            
                            output += `ğŸ“‹ è®¢å•åˆ—è¡¨:\n`;
                            data.slice(0, 5).forEach((order, index) => {
                                output += `${index + 1}. ${order.orderNumber} - ${order.status}\n`;
                                output += `   è´¹ç”¨: Â¥${order.actualFare || order.estimatedFare || '0'}\n`;
                                output += `   æ—¶é—´: ${order.createdAt}\n\n`;
                            });
                            
                            if (data.length > 5) {
                                output += `... è¿˜æœ‰ ${data.length - 5} æ¡è®°å½•\n`;
                            }
                        }
                    }
                    
                    return output;
                };

                // æµ‹è¯•å‡½æ•°
                const testBasicQuery = async () => {
                    basicResult.value = 'ğŸ”„ æ­£åœ¨æŸ¥è¯¢...';
                    const result = await makeRequest({ page: 1, size: pageSize.value });
                    basicResult.value = formatResult(result);
                };

                const testStatusFilter = async () => {
                    statusResult.value = 'ğŸ”„ æ­£åœ¨æŸ¥è¯¢...';
                    const result = await makeRequest({ 
                        status: statusFilter.value,
                        page: 1, 
                        size: pageSize.value 
                    });
                    statusResult.value = formatResult(result);
                };

                const testDateRange = async () => {
                    dateResult.value = 'ğŸ”„ æ­£åœ¨æŸ¥è¯¢...';
                    const params = { page: 1, size: pageSize.value };
                    if (dateRange.value && dateRange.value.length === 2) {
                        params.startDate = dateRange.value[0];
                        params.endDate = dateRange.value[1];
                    }
                    const result = await makeRequest(params);
                    dateResult.value = formatResult(result);
                };

                const testPagination = async () => {
                    paginationResult.value = 'ğŸ”„ æ­£åœ¨æµ‹è¯•åˆ†é¡µ...';
                    let output = 'ğŸ“„ åˆ†é¡µæµ‹è¯•ç»“æœ:\n\n';
                    
                    for (let page = 1; page <= 2; page++) {
                        const result = await makeRequest({ page, size: pageSize.value });
                        output += `ç¬¬ ${page} é¡µ:\n`;
                        if (result.success && Array.isArray(result.data)) {
                            output += `- è®°å½•æ•°: ${result.data.length}\n\n`;
                        } else {
                            output += `- æŸ¥è¯¢å¤±è´¥æˆ–æ— æ•°æ®\n\n`;
                        }
                    }
                    
                    paginationResult.value = output;
                };

                return {
                    driverId,
                    statusFilter,
                    dateRange,
                    pageSize,
                    basicResult,
                    statusResult,
                    dateResult,
                    paginationResult,
                    testBasicQuery,
                    testStatusFilter,
                    testDateRange,
                    testPagination
                };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>