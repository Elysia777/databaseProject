<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸æœºä¿¡æ¯æ˜¾ç¤ºä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        button {
            background: #409EFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #66b1ff;
        }
        .result-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .status-good {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .status-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .driver-info-preview {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .driver-info-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        .label {
            font-weight: bold;
            color: #495057;
        }
        .value {
            color: #212529;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ å¸æœºä¿¡æ¯æ˜¾ç¤ºä¿®å¤æµ‹è¯•</h1>
        <p>æµ‹è¯•ä¹˜å®¢ç«¯æ˜¯å¦èƒ½æ­£ç¡®æ˜¾ç¤ºå¸æœºè½¦è¾†ä¿¡æ¯</p>
    </div>

    <div class="container">
        <h3>æ­¥éª¤1: æ¨¡æ‹ŸWebSocketæ¶ˆæ¯</h3>
        <button onclick="simulateWebSocketMessage()">æ¨¡æ‹Ÿå¸æœºæ¥å•æ¶ˆæ¯</button>
        <div id="messageResult" class="result-display">
            ç‚¹å‡»æ¨¡æ‹ŸWebSocketæ¶ˆæ¯...
        </div>
    </div>

    <div class="container">
        <h3>æ­¥éª¤2: æµ‹è¯•ä¿¡æ¯æå–</h3>
        <button onclick="testInfoExtraction()">æµ‹è¯•ä¿¡æ¯æå–é€»è¾‘</button>
        <div id="extractionResult" class="result-display">
            ç‚¹å‡»æµ‹è¯•ä¿¡æ¯æå–...
        </div>
    </div>

    <div class="container">
        <h3>æ­¥éª¤3: é¢„è§ˆæ˜¾ç¤ºæ•ˆæœ</h3>
        <div id="previewResult" class="driver-info-preview" style="display: none;">
            <h4>å¸æœºä¿¡æ¯é¢„è§ˆ</h4>
            <div class="driver-info-item">
                <span class="label">å¸æœºå§“å:</span>
                <span class="value" id="previewName">-</span>
            </div>
            <div class="driver-info-item">
                <span class="label">è½¦ç‰Œå·:</span>
                <span class="value" id="previewPlate">-</span>
            </div>
            <div class="driver-info-item">
                <span class="label">è½¦å‹:</span>
                <span class="value" id="previewModel">-</span>
            </div>
            <div class="driver-info-item">
                <span class="label">é¢œè‰²:</span>
                <span class="value" id="previewColor">-</span>
            </div>
            <div class="driver-info-item">
                <span class="label">ç±»å‹:</span>
                <span class="value" id="previewType">-</span>
            </div>
        </div>
    </div>

    <script>
        function log(message, containerId = 'result') {
            const container = document.getElementById(containerId);
            const timestamp = new Date().toLocaleTimeString();
            container.textContent += `[${timestamp}] ${message}\n`;
            container.scrollTop = container.scrollHeight;
            console.log(message);
        }

        // æ¨¡æ‹Ÿä½ æä¾›çš„WebSocketæ¶ˆæ¯
        const mockWebSocketMessage = {
            "driver": {
                "vehicleColor": "ç™½è‰²",
                "latitude": 39.04170548630136,
                "rating": 5,
                "vehicleInfo": "we 123 s123445",
                "avatar": null,
                "plateNumber": "s123445",
                "vehicleBrand": "we",
                "phoneNumber": "13164586598",
                "vehicleYear": 2025,
                "driverId": 1,
                "phone": "13164586598",
                "vehicleSeats": 5,
                "name": "qyj",
                "vehicleModel": "123",
                "driverName": "qyj",
                "id": 1,
                "vehicleType": "COMFORT",
                "carModel": "we 123",
                "longitude": 121.79689317941666
            },
            "type": "ORDER_ASSIGNED",
            "order": {
                "orderNumber": "ORDER1754426749071b2fb5eb5",
                "destinationAddress": "å±±ä¸œå¤§å­¦(ä¸­å¿ƒæ ¡åŒº)",
                "pickupAddress": "ä½ç½® (39.041706, 121.796893)",
                "pickupLongitude": 121.796893,
                "estimatedFare": 2785,
                "id": 365,
                "destinationLatitude": 36.675668,
                "destinationLongitude": 117.060109,
                "pickupLatitude": 39.041706,
                "status": "ASSIGNED"
            },
            "timestamp": 1754426750353
        };

        function simulateWebSocketMessage() {
            const resultDiv = document.getElementById('messageResult');
            resultDiv.textContent = '';
            resultDiv.className = 'result-display';
            
            log('ğŸ“¨ æ¨¡æ‹ŸWebSocketæ¶ˆæ¯...', 'messageResult');
            log('æ¶ˆæ¯ç±»å‹: ' + mockWebSocketMessage.type, 'messageResult');
            log('å¸æœºID: ' + mockWebSocketMessage.driver.id, 'messageResult');
            log('å¸æœºå§“å: ' + mockWebSocketMessage.driver.name, 'messageResult');
            
            log('\nğŸš— è½¦è¾†ä¿¡æ¯:', 'messageResult');
            log('è½¦ç‰Œå·: ' + mockWebSocketMessage.driver.plateNumber, 'messageResult');
            log('å“ç‰Œ: ' + mockWebSocketMessage.driver.vehicleBrand, 'messageResult');
            log('å‹å·: ' + mockWebSocketMessage.driver.vehicleModel, 'messageResult');
            log('é¢œè‰²: ' + mockWebSocketMessage.driver.vehicleColor, 'messageResult');
            log('ç±»å‹: ' + mockWebSocketMessage.driver.vehicleType, 'messageResult');
            log('åº§ä½æ•°: ' + mockWebSocketMessage.driver.vehicleSeats, 'messageResult');
            log('å¹´ä»½: ' + mockWebSocketMessage.driver.vehicleYear, 'messageResult');
            
            resultDiv.className = 'result-display status-good';
        }

        function testInfoExtraction() {
            const resultDiv = document.getElementById('extractionResult');
            resultDiv.textContent = '';
            resultDiv.className = 'result-display';
            
            log('ğŸ”§ æµ‹è¯•ä¿¡æ¯æå–é€»è¾‘...', 'extractionResult');
            
            // æ¨¡æ‹Ÿä¿®å¤åçš„handleOrderAssignedé€»è¾‘
            const data = mockWebSocketMessage;
            
            if (data.driver) {
                const driverData = {
                    id: data.driver.id || data.driver.driverId,
                    name: data.driver.name || data.driver.driverName || "å¸æœº",
                    phone: data.driver.phone || data.driver.phoneNumber,
                    avatar: data.driver.avatar,
                    rating: data.driver.rating || 5.0,
                    // è½¦è¾†ä¿¡æ¯
                    plateNumber: data.driver.plateNumber || "æš‚æ— è½¦ç‰Œ",
                    vehicleBrand: data.driver.vehicleBrand || "æœªçŸ¥",
                    vehicleModel: data.driver.vehicleModel || "",
                    vehicleColor: data.driver.vehicleColor || "æœªçŸ¥",
                    vehicleType: data.driver.vehicleType || "ECONOMY",
                    vehicleSeats: data.driver.vehicleSeats || 5,
                    vehicleYear: data.driver.vehicleYear,
                    vehicleInfo: data.driver.vehicleInfo || data.driver.carModel || `${data.driver.vehicleBrand || 'æœªçŸ¥'} ${data.driver.vehicleModel || ''} ${data.driver.plateNumber || ''}`.trim(),
                    carModel: data.driver.carModel || `${data.driver.vehicleBrand || 'æœªçŸ¥'} ${data.driver.vehicleModel || ''}`.trim(),
                    latitude: data.driver.latitude,
                    longitude: data.driver.longitude,
                };
                
                log('âœ… æå–çš„å¸æœºæ•°æ®:', 'extractionResult');
                log('ID: ' + driverData.id, 'extractionResult');
                log('å§“å: ' + driverData.name, 'extractionResult');
                log('ç”µè¯: ' + driverData.phone, 'extractionResult');
                log('è¯„åˆ†: ' + driverData.rating, 'extractionResult');
                
                log('\nğŸš— æå–çš„è½¦è¾†æ•°æ®:', 'extractionResult');
                log('è½¦ç‰Œå·: ' + driverData.plateNumber, 'extractionResult');
                log('å“ç‰Œ: ' + driverData.vehicleBrand, 'extractionResult');
                log('å‹å·: ' + driverData.vehicleModel, 'extractionResult');
                log('é¢œè‰²: ' + driverData.vehicleColor, 'extractionResult');
                log('ç±»å‹: ' + driverData.vehicleType, 'extractionResult');
                log('åº§ä½æ•°: ' + driverData.vehicleSeats, 'extractionResult');
                log('å¹´ä»½: ' + driverData.vehicleYear, 'extractionResult');
                log('è½¦è¾†ä¿¡æ¯: ' + driverData.vehicleInfo, 'extractionResult');
                log('è½¦å‹: ' + driverData.carModel, 'extractionResult');
                
                // æ›´æ–°é¢„è§ˆ
                updatePreview(driverData);
                
                resultDiv.className = 'result-display status-good';
            } else {
                log('âŒ æ²¡æœ‰å¸æœºæ•°æ®', 'extractionResult');
                resultDiv.className = 'result-display status-error';
            }
        }

        function updatePreview(driverData) {
            const previewDiv = document.getElementById('previewResult');
            previewDiv.style.display = 'block';
            
            document.getElementById('previewName').textContent = driverData.name;
            document.getElementById('previewPlate').textContent = driverData.plateNumber;
            document.getElementById('previewModel').textContent = `${driverData.vehicleBrand} ${driverData.vehicleModel}`;
            document.getElementById('previewColor').textContent = driverData.vehicleColor;
            document.getElementById('previewType').textContent = getVehicleTypeText(driverData.vehicleType);
        }

        function getVehicleTypeText(type) {
            const typeMap = {
                'ECONOMY': 'ç»æµå‹',
                'COMFORT': 'èˆ’é€‚å‹',
                'PREMIUM': 'é«˜çº§å‹',
                'LUXURY': 'è±ªåå‹'
            };
            return typeMap[type] || 'ç»æµå‹';
        }

        // é¡µé¢åŠ è½½æ—¶çš„è¯´æ˜
        window.onload = function() {
            log('å¸æœºä¿¡æ¯æ˜¾ç¤ºä¿®å¤æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ', 'messageResult');
            log('æŒ‰é¡ºåºç‚¹å‡»æŒ‰é’®è¿›è¡Œæµ‹è¯•', 'messageResult');
        };
    </script>
</body>
</html>