<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>拖拽修复测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-result {
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            color: #0d47a1;
        }
        button {
            background: #409EFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #66b1ff;
        }
        .code {
            background: #2d3748;
            color: #e2e8f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔧 拖拽修复测试</h1>
        <p>测试起始点标记拖拽功能的修复效果</p>
    </div>

    <div class="container">
        <h3>修复内容总结</h3>
        <div class="info">
            <h4>✅ 已实现的修复：</h4>
            <ul>
                <li><strong>修改拖拽逻辑</strong>: 只有在订单真正进行中时才禁用拖拽</li>
                <li><strong>增加延迟时间</strong>: 500ms和1000ms双重延迟确保地图初始化</li>
                <li><strong>添加状态监听</strong>: watch监听订单状态变化自动更新拖拽状态</li>
                <li><strong>增强日志输出</strong>: 详细的调试信息便于问题排查</li>
            </ul>
        </div>

        <div class="test-result success">
            <h4>🎯 修复逻辑：</h4>
            <div class="code">
// 新的拖拽判断逻辑
const isOrderInProgress = currentOrder.value && 
                         ['ASSIGNED', 'PICKUP', 'IN_PROGRESS'].includes(orderStatus.value);
const isDraggable = !isOrderInProgress;

// 这意味着：
// - 没有订单时：可以拖拽 ✅
// - 订单状态为PENDING时：可以拖拽 ✅  
// - 订单状态为ASSIGNED/PICKUP/IN_PROGRESS时：不可拖拽 ❌
            </div>
        </div>

        <h3>测试步骤</h3>
        <div class="container">
            <div class="test-result info">
                <h4>1. 基础拖拽测试</h4>
                <p>在没有订单的情况下，起始点标记应该可以拖拽</p>
                <ul>
                    <li>打开乘客地图页面</li>
                    <li>等待定位完成，出现起始点标记</li>
                    <li>尝试拖拽起始点标记</li>
                    <li>预期结果：标记可以正常拖拽</li>
                </ul>
            </div>

            <div class="test-result info">
                <h4>2. 订单状态测试</h4>
                <p>在不同订单状态下测试拖拽行为</p>
                <ul>
                    <li>创建订单（状态：PENDING）- 应该可以拖拽</li>
                    <li>司机接单（状态：ASSIGNED）- 应该不可拖拽</li>
                    <li>司机到达（状态：PICKUP）- 应该不可拖拽</li>
                    <li>开始行程（状态：IN_PROGRESS）- 应该不可拖拽</li>
                </ul>
            </div>

            <div class="test-result info">
                <h4>3. F12效应测试</h4>
                <p>验证是否还需要依赖F12来启用拖拽</p>
                <ul>
                    <li>在正常状态下测试拖拽</li>
                    <li>打开F12开发者工具</li>
                    <li>关闭F12开发者工具</li>
                    <li>预期结果：拖拽状态不应该受F12影响</li>
                </ul>
            </div>
        </div>

        <h3>调试命令</h3>
        <div class="container">
            <p>如果拖拽仍然有问题，在浏览器控制台执行以下命令：</p>
            
            <div class="code">
// 检查当前状态
console.log("标记存在:", !!window.pickupMarker);
console.log("标记可拖拽:", window.pickupMarker?.getDraggable());
console.log("当前订单:", window.currentOrder?.value);
console.log("订单状态:", window.orderStatus?.value);

// 强制启用拖拽（临时测试）
if (window.pickupMarker) {
    window.pickupMarker.setDraggable(true);
    console.log("✅ 已强制启用拖拽");
}

// 手动调用更新函数
if (typeof window.updatePickupMarkerDraggable === 'function') {
    window.updatePickupMarkerDraggable();
    console.log("✅ 已手动更新拖拽状态");
}
            </div>
            <button onclick="copyToClipboard(this.previousElementSibling.textContent)">复制调试命令</button>
        </div>

        <div class="test-result success">
            <h4>🎉 预期效果</h4>
            <p>修复后，起始点标记应该：</p>
            <ul>
                <li>在页面加载后立即可以拖拽</li>
                <li>不需要打开F12就能正常拖拽</li>
                <li>只有在司机接单后才禁用拖拽</li>
                <li>状态变化时自动更新拖拽状态</li>
            </ul>
        </div>
    </div>

    <script>
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('调试命令已复制到剪贴板！');
            }).catch(err => {
                console.error('复制失败:', err);
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('调试命令已复制到剪贴板！');
            });
        }

        window.onload = function() {
            console.log('🔧 拖拽修复测试页面已加载');
            console.log('请按照页面说明进行测试');
        };
    </script>
</body>
</html>"