<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å‘˜è´¦å·ç®¡ç†</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 600;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-full {
            grid-column: 1 / -1;
        }
        
        .admin-list {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .admin-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-info h4 {
            margin: 0 0 5px 0;
            color: #333;
        }
        
        .admin-info p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }
        
        .success-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .error-message {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .quick-actions {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .quick-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .quick-btn.primary {
            background: #007bff;
            color: white;
        }
        
        .quick-btn.success {
            background: #28a745;
            color: white;
        }
        
        .quick-btn.warning {
            background: #ffc107;
            color: #212529;
        }
        
        .quick-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <div class="header">
                <h1>ğŸ›¡ï¸ ç®¡ç†å‘˜è´¦å·ç®¡ç†</h1>
                <p>åˆ›å»ºå’Œç®¡ç†ç³»ç»Ÿç®¡ç†å‘˜è´¦å·</p>
            </div>
            
            <div class="content">
                <!-- å¿«é€Ÿæ“ä½œ -->
                <div class="section">
                    <div class="section-title">ğŸš€ å¿«é€Ÿæ“ä½œ</div>
                    <div class="quick-actions">
                        <button class="quick-btn primary" @click="createQuickAdmin('admin', '123456')">
                            åˆ›å»º admin/123456
                        </button>
                        <button class="quick-btn primary" @click="createQuickAdmin('superadmin', '123456')">
                            åˆ›å»º superadmin/123456
                        </button>
                        <button class="quick-btn warning" @click="resetQuickPassword('admin', '123456')">
                            é‡ç½® admin å¯†ç ä¸º 123456
                        </button>
                        <button class="quick-btn success" @click="loadAdminList">
                            åˆ·æ–°ç®¡ç†å‘˜åˆ—è¡¨
                        </button>
                    </div>
                </div>

                <!-- åˆ›å»ºç®¡ç†å‘˜ -->
                <div class="section">
                    <div class="section-title">â• åˆ›å»ºæ–°ç®¡ç†å‘˜</div>
                    <el-form :model="createForm" label-width="100px">
                        <div class="form-grid">
                            <el-form-item label="ç”¨æˆ·å" required>
                                <el-input v-model="createForm.username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" />
                            </el-form-item>
                            <el-form-item label="å¯†ç " required>
                                <el-input v-model="createForm.password" type="password" placeholder="è¯·è¾“å…¥å¯†ç " show-password />
                            </el-form-item>
                            <el-form-item label="çœŸå®å§“å" required>
                                <el-input v-model="createForm.realName" placeholder="è¯·è¾“å…¥çœŸå®å§“å" />
                            </el-form-item>
                            <el-form-item label="æ‰‹æœºå·">
                                <el-input v-model="createForm.phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" />
                            </el-form-item>
                            <el-form-item label="é‚®ç®±">
                                <el-input v-model="createForm.email" placeholder="è¯·è¾“å…¥é‚®ç®±" />
                            </el-form-item>
                            <el-form-item label="è§’è‰²">
                                <el-select v-model="createForm.role" placeholder="é€‰æ‹©è§’è‰²">
                                    <el-option label="è¶…çº§ç®¡ç†å‘˜" value="SUPER_ADMIN" />
                                    <el-option label="ç®¡ç†å‘˜" value="ADMIN" />
                                    <el-option label="æ“ä½œå‘˜" value="OPERATOR" />
                                </el-select>
                            </el-form-item>
                            <el-form-item label="éƒ¨é—¨">
                                <el-input v-model="createForm.department" placeholder="è¯·è¾“å…¥éƒ¨é—¨" />
                            </el-form-item>
                            <el-form-item label="èŒä½">
                                <el-input v-model="createForm.position" placeholder="è¯·è¾“å…¥èŒä½" />
                            </el-form-item>
                        </div>
                        <div class="form-full">
                            <el-form-item label="æƒé™">
                                <el-input v-model="createForm.permissions" 
                                         type="textarea" 
                                         placeholder="æƒé™åˆ—è¡¨ï¼Œç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼šUSER_MANAGEMENT,ORDER_MANAGEMENT" />
                            </el-form-item>
                        </div>
                        <el-form-item>
                            <el-button type="primary" @click="createAdmin" :loading="creating">
                                åˆ›å»ºç®¡ç†å‘˜
                            </el-button>
                            <el-button @click="resetCreateForm">é‡ç½®</el-button>
                        </el-form-item>
                    </el-form>
                </div>

                <!-- å¯†ç é‡ç½® -->
                <div class="section">
                    <div class="section-title">ğŸ”‘ é‡ç½®å¯†ç </div>
                    <el-form :model="resetForm" label-width="100px">
                        <div class="form-grid">
                            <el-form-item label="ç”¨æˆ·å" required>
                                <el-input v-model="resetForm.username" placeholder="è¯·è¾“å…¥è¦é‡ç½®å¯†ç çš„ç”¨æˆ·å" />
                            </el-form-item>
                            <el-form-item label="æ–°å¯†ç " required>
                                <el-input v-model="resetForm.newPassword" type="password" placeholder="è¯·è¾“å…¥æ–°å¯†ç " show-password />
                            </el-form-item>
                        </div>
                        <el-form-item>
                            <el-button type="warning" @click="resetPassword" :loading="resetting">
                                é‡ç½®å¯†ç 
                            </el-button>
                        </el-form-item>
                    </el-form>
                </div>

                <!-- ç®¡ç†å‘˜åˆ—è¡¨ -->
                <div class="section">
                    <div class="section-title">ğŸ‘¥ ç°æœ‰ç®¡ç†å‘˜</div>
                    <div class="admin-list">
                        <div v-if="adminList.length === 0" style="text-align: center; color: #999; padding: 20px;">
                            æš‚æ— ç®¡ç†å‘˜æ•°æ®ï¼Œç‚¹å‡»"åˆ·æ–°ç®¡ç†å‘˜åˆ—è¡¨"åŠ è½½
                        </div>
                        <div v-for="admin in adminList" :key="admin.id" class="admin-item">
                            <div class="admin-info">
                                <h4>{{ admin.realName || admin.username }}</h4>
                                <p>ç”¨æˆ·å: {{ admin.username }} | ç±»å‹: {{ admin.userType }} | çŠ¶æ€: {{ admin.status }}</p>
                                <p v-if="admin.phone">æ‰‹æœº: {{ admin.phone }}</p>
                                <p v-if="admin.email">é‚®ç®±: {{ admin.email }}</p>
                            </div>
                            <div>
                                <el-button size="small" @click="resetForm.username = admin.username">
                                    é‡ç½®å¯†ç 
                                </el-button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å¯†ç å“ˆå¸Œå·¥å…· -->
                <div class="section">
                    <div class="section-title">ğŸ”§ å¯†ç å“ˆå¸Œå·¥å…·</div>
                    <el-form :model="hashForm" label-width="100px">
                        <div class="form-grid">
                            <el-form-item label="æ˜æ–‡å¯†ç ">
                                <el-input v-model="hashForm.password" placeholder="è¯·è¾“å…¥è¦ç”Ÿæˆå“ˆå¸Œçš„å¯†ç " />
                            </el-form-item>
                            <el-form-item>
                                <el-button @click="generateHash" :loading="hashing">ç”Ÿæˆå“ˆå¸Œ</el-button>
                            </el-form-item>
                        </div>
                        <div class="form-full" v-if="hashResult">
                            <el-form-item label="å“ˆå¸Œç»“æœ">
                                <el-input v-model="hashResult" type="textarea" readonly />
                            </el-form-item>
                        </div>
                    </el-form>
                </div>

                <!-- æ¶ˆæ¯æ˜¾ç¤º -->
                <div v-if="successMessage" class="success-message">
                    {{ successMessage }}
                </div>
                <div v-if="errorMessage" class="error-message">
                    {{ errorMessage }}
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, reactive, onMounted } = Vue;
        const { ElMessage } = ElementPlus;

        createApp({
            setup() {
                const API_BASE = 'http://localhost:8080';

                // è¡¨å•æ•°æ®
                const createForm = reactive({
                    username: '',
                    password: '',
                    realName: '',
                    phone: '',
                    email: '',
                    role: 'ADMIN',
                    department: '',
                    position: '',
                    permissions: 'USER_MANAGEMENT,ORDER_MANAGEMENT,REVIEW_MANAGEMENT,STATISTICS'
                });

                const resetForm = reactive({
                    username: '',
                    newPassword: ''
                });

                const hashForm = reactive({
                    password: ''
                });

                // çŠ¶æ€
                const creating = ref(false);
                const resetting = ref(false);
                const hashing = ref(false);
                const adminList = ref([]);
                const successMessage = ref('');
                const errorMessage = ref('');
                const hashResult = ref('');

                // æ˜¾ç¤ºæ¶ˆæ¯
                const showMessage = (message, type = 'success') => {
                    if (type === 'success') {
                        successMessage.value = message;
                        errorMessage.value = '';
                        ElMessage.success(message);
                    } else {
                        errorMessage.value = message;
                        successMessage.value = '';
                        ElMessage.error(message);
                    }
                    
                    // 3ç§’åæ¸…é™¤æ¶ˆæ¯
                    setTimeout(() => {
                        successMessage.value = '';
                        errorMessage.value = '';
                    }, 3000);
                };

                // åˆ›å»ºç®¡ç†å‘˜
                const createAdmin = async () => {
                    if (!createForm.username || !createForm.password || !createForm.realName) {
                        showMessage('è¯·å¡«å†™å¿…å¡«å­—æ®µ', 'error');
                        return;
                    }

                    creating.value = true;
                    try {
                        const response = await fetch(`${API_BASE}/api/admin/management/create`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(createForm)
                        });

                        const result = await response.json();
                        
                        if (response.ok && result.code === 200) {
                            showMessage(`ç®¡ç†å‘˜ ${result.data.username} åˆ›å»ºæˆåŠŸï¼`);
                            resetCreateForm();
                            loadAdminList();
                        } else {
                            showMessage(result.message || 'åˆ›å»ºå¤±è´¥', 'error');
                        }
                    } catch (error) {
                        showMessage('ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
                    } finally {
                        creating.value = false;
                    }
                };

                // é‡ç½®å¯†ç 
                const resetPassword = async () => {
                    if (!resetForm.username || !resetForm.newPassword) {
                        showMessage('è¯·å¡«å†™ç”¨æˆ·åå’Œæ–°å¯†ç ', 'error');
                        return;
                    }

                    resetting.value = true;
                    try {
                        const response = await fetch(`${API_BASE}/api/admin/management/reset-password`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(resetForm)
                        });

                        const result = await response.json();
                        
                        if (response.ok && result.code === 200) {
                            showMessage(`ç”¨æˆ· ${resetForm.username} å¯†ç é‡ç½®æˆåŠŸï¼`);
                            resetForm.username = '';
                            resetForm.newPassword = '';
                        } else {
                            showMessage(result.message || 'é‡ç½®å¤±è´¥', 'error');
                        }
                    } catch (error) {
                        showMessage('ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
                    } finally {
                        resetting.value = false;
                    }
                };

                // ç”Ÿæˆå¯†ç å“ˆå¸Œ
                const generateHash = async () => {
                    if (!hashForm.password) {
                        showMessage('è¯·è¾“å…¥è¦ç”Ÿæˆå“ˆå¸Œçš„å¯†ç ', 'error');
                        return;
                    }

                    hashing.value = true;
                    try {
                        const response = await fetch(`${API_BASE}/api/admin/management/generate-hash`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ password: hashForm.password })
                        });

                        const result = await response.json();
                        
                        if (response.ok && result.code === 200) {
                            hashResult.value = `å¯†ç : ${result.data.password}\nå“ˆå¸Œ: ${result.data.hash}`;
                            showMessage('å¯†ç å“ˆå¸Œç”ŸæˆæˆåŠŸï¼');
                        } else {
                            showMessage(result.message || 'ç”Ÿæˆå¤±è´¥', 'error');
                        }
                    } catch (error) {
                        showMessage('ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
                    } finally {
                        hashing.value = false;
                    }
                };

                // åŠ è½½ç®¡ç†å‘˜åˆ—è¡¨
                const loadAdminList = async () => {
                    try {
                        const response = await fetch(`${API_BASE}/api/users`);
                        const result = await response.json();
                        
                        if (response.ok && result.code === 200) {
                            adminList.value = result.data.filter(user => user.userType === 'ADMIN');
                            showMessage(`åŠ è½½åˆ° ${adminList.value.length} ä¸ªç®¡ç†å‘˜`);
                        } else {
                            showMessage('åŠ è½½ç®¡ç†å‘˜åˆ—è¡¨å¤±è´¥', 'error');
                        }
                    } catch (error) {
                        showMessage('ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
                    }
                };

                // å¿«é€Ÿåˆ›å»ºç®¡ç†å‘˜
                const createQuickAdmin = (username, password) => {
                    createForm.username = username;
                    createForm.password = password;
                    createForm.realName = username === 'superadmin' ? 'è¶…çº§ç®¡ç†å‘˜' : 'ç³»ç»Ÿç®¡ç†å‘˜';
                    createForm.phone = username === 'superadmin' ? '13800000001' : '13800000000';
                    createForm.email = username === 'superadmin' ? 'superadmin@taxi.com' : 'admin@taxi.com';
                    createForm.role = username === 'superadmin' ? 'SUPER_ADMIN' : 'ADMIN';
                    createForm.department = 'æŠ€æœ¯éƒ¨';
                    createForm.position = username === 'superadmin' ? 'è¶…çº§ç®¡ç†å‘˜' : 'ç³»ç»Ÿç®¡ç†å‘˜';
                    createForm.permissions = username === 'superadmin' ? 'ALL' : 'USER_MANAGEMENT,ORDER_MANAGEMENT,REVIEW_MANAGEMENT,STATISTICS';
                    createAdmin();
                };

                // å¿«é€Ÿé‡ç½®å¯†ç 
                const resetQuickPassword = (username, password) => {
                    resetForm.username = username;
                    resetForm.newPassword = password;
                    resetPassword();
                };

                // é‡ç½®åˆ›å»ºè¡¨å•
                const resetCreateForm = () => {
                    Object.assign(createForm, {
                        username: '',
                        password: '',
                        realName: '',
                        phone: '',
                        email: '',
                        role: 'ADMIN',
                        department: '',
                        position: '',
                        permissions: 'USER_MANAGEMENT,ORDER_MANAGEMENT,REVIEW_MANAGEMENT,STATISTICS'
                    });
                };

                // é¡µé¢åŠ è½½æ—¶è·å–ç®¡ç†å‘˜åˆ—è¡¨
                onMounted(() => {
                    loadAdminList();
                });

                return {
                    createForm,
                    resetForm,
                    hashForm,
                    creating,
                    resetting,
                    hashing,
                    adminList,
                    successMessage,
                    errorMessage,
                    hashResult,
                    createAdmin,
                    resetPassword,
                    generateHash,
                    loadAdminList,
                    createQuickAdmin,
                    resetQuickPassword,
                    resetCreateForm
                };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>