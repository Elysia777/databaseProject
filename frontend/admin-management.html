<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理员账号管理</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 600;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-full {
            grid-column: 1 / -1;
        }
        
        .admin-list {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .admin-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-info h4 {
            margin: 0 0 5px 0;
            color: #333;
        }
        
        .admin-info p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }
        
        .success-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .error-message {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .quick-actions {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .quick-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .quick-btn.primary {
            background: #007bff;
            color: white;
        }
        
        .quick-btn.success {
            background: #28a745;
            color: white;
        }
        
        .quick-btn.warning {
            background: #ffc107;
            color: #212529;
        }
        
        .quick-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <div class="header">
                <h1>🛡️ 管理员账号管理</h1>
                <p>创建和管理系统管理员账号</p>
            </div>
            
            <div class="content">
                <!-- 快速操作 -->
                <div class="section">
                    <div class="section-title">🚀 快速操作</div>
                    <div class="quick-actions">
                        <button class="quick-btn primary" @click="createQuickAdmin('admin', '123456')">
                            创建 admin/123456
                        </button>
                        <button class="quick-btn primary" @click="createQuickAdmin('superadmin', '123456')">
                            创建 superadmin/123456
                        </button>
                        <button class="quick-btn warning" @click="resetQuickPassword('admin', '123456')">
                            重置 admin 密码为 123456
                        </button>
                        <button class="quick-btn success" @click="loadAdminList">
                            刷新管理员列表
                        </button>
                    </div>
                </div>

                <!-- 创建管理员 -->
                <div class="section">
                    <div class="section-title">➕ 创建新管理员</div>
                    <el-form :model="createForm" label-width="100px">
                        <div class="form-grid">
                            <el-form-item label="用户名" required>
                                <el-input v-model="createForm.username" placeholder="请输入用户名" />
                            </el-form-item>
                            <el-form-item label="密码" required>
                                <el-input v-model="createForm.password" type="password" placeholder="请输入密码" show-password />
                            </el-form-item>
                            <el-form-item label="真实姓名" required>
                                <el-input v-model="createForm.realName" placeholder="请输入真实姓名" />
                            </el-form-item>
                            <el-form-item label="手机号">
                                <el-input v-model="createForm.phone" placeholder="请输入手机号" />
                            </el-form-item>
                            <el-form-item label="邮箱">
                                <el-input v-model="createForm.email" placeholder="请输入邮箱" />
                            </el-form-item>
                            <el-form-item label="角色">
                                <el-select v-model="createForm.role" placeholder="选择角色">
                                    <el-option label="超级管理员" value="SUPER_ADMIN" />
                                    <el-option label="管理员" value="ADMIN" />
                                    <el-option label="操作员" value="OPERATOR" />
                                </el-select>
                            </el-form-item>
                            <el-form-item label="部门">
                                <el-input v-model="createForm.department" placeholder="请输入部门" />
                            </el-form-item>
                            <el-form-item label="职位">
                                <el-input v-model="createForm.position" placeholder="请输入职位" />
                            </el-form-item>
                        </div>
                        <div class="form-full">
                            <el-form-item label="权限">
                                <el-input v-model="createForm.permissions" 
                                         type="textarea" 
                                         placeholder="权限列表，用逗号分隔，如：USER_MANAGEMENT,ORDER_MANAGEMENT" />
                            </el-form-item>
                        </div>
                        <el-form-item>
                            <el-button type="primary" @click="createAdmin" :loading="creating">
                                创建管理员
                            </el-button>
                            <el-button @click="resetCreateForm">重置</el-button>
                        </el-form-item>
                    </el-form>
                </div>

                <!-- 密码重置 -->
                <div class="section">
                    <div class="section-title">🔑 重置密码</div>
                    <el-form :model="resetForm" label-width="100px">
                        <div class="form-grid">
                            <el-form-item label="用户名" required>
                                <el-input v-model="resetForm.username" placeholder="请输入要重置密码的用户名" />
                            </el-form-item>
                            <el-form-item label="新密码" required>
                                <el-input v-model="resetForm.newPassword" type="password" placeholder="请输入新密码" show-password />
                            </el-form-item>
                        </div>
                        <el-form-item>
                            <el-button type="warning" @click="resetPassword" :loading="resetting">
                                重置密码
                            </el-button>
                        </el-form-item>
                    </el-form>
                </div>

                <!-- 管理员列表 -->
                <div class="section">
                    <div class="section-title">👥 现有管理员</div>
                    <div class="admin-list">
                        <div v-if="adminList.length === 0" style="text-align: center; color: #999; padding: 20px;">
                            暂无管理员数据，点击"刷新管理员列表"加载
                        </div>
                        <div v-for="admin in adminList" :key="admin.id" class="admin-item">
                            <div class="admin-info">
                                <h4>{{ admin.realName || admin.username }}</h4>
                                <p>用户名: {{ admin.username }} | 类型: {{ admin.userType }} | 状态: {{ admin.status }}</p>
                                <p v-if="admin.phone">手机: {{ admin.phone }}</p>
                                <p v-if="admin.email">邮箱: {{ admin.email }}</p>
                            </div>
                            <div>
                                <el-button size="small" @click="resetForm.username = admin.username">
                                    重置密码
                                </el-button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 密码哈希工具 -->
                <div class="section">
                    <div class="section-title">🔧 密码哈希工具</div>
                    <el-form :model="hashForm" label-width="100px">
                        <div class="form-grid">
                            <el-form-item label="明文密码">
                                <el-input v-model="hashForm.password" placeholder="请输入要生成哈希的密码" />
                            </el-form-item>
                            <el-form-item>
                                <el-button @click="generateHash" :loading="hashing">生成哈希</el-button>
                            </el-form-item>
                        </div>
                        <div class="form-full" v-if="hashResult">
                            <el-form-item label="哈希结果">
                                <el-input v-model="hashResult" type="textarea" readonly />
                            </el-form-item>
                        </div>
                    </el-form>
                </div>

                <!-- 消息显示 -->
                <div v-if="successMessage" class="success-message">
                    {{ successMessage }}
                </div>
                <div v-if="errorMessage" class="error-message">
                    {{ errorMessage }}
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, reactive, onMounted } = Vue;
        const { ElMessage } = ElementPlus;

        createApp({
            setup() {
                const API_BASE = 'http://localhost:8080';

                // 表单数据
                const createForm = reactive({
                    username: '',
                    password: '',
                    realName: '',
                    phone: '',
                    email: '',
                    role: 'ADMIN',
                    department: '',
                    position: '',
                    permissions: 'USER_MANAGEMENT,ORDER_MANAGEMENT,REVIEW_MANAGEMENT,STATISTICS'
                });

                const resetForm = reactive({
                    username: '',
                    newPassword: ''
                });

                const hashForm = reactive({
                    password: ''
                });

                // 状态
                const creating = ref(false);
                const resetting = ref(false);
                const hashing = ref(false);
                const adminList = ref([]);
                const successMessage = ref('');
                const errorMessage = ref('');
                const hashResult = ref('');

                // 显示消息
                const showMessage = (message, type = 'success') => {
                    if (type === 'success') {
                        successMessage.value = message;
                        errorMessage.value = '';
                        ElMessage.success(message);
                    } else {
                        errorMessage.value = message;
                        successMessage.value = '';
                        ElMessage.error(message);
                    }
                    
                    // 3秒后清除消息
                    setTimeout(() => {
                        successMessage.value = '';
                        errorMessage.value = '';
                    }, 3000);
                };

                // 创建管理员
                const createAdmin = async () => {
                    if (!createForm.username || !createForm.password || !createForm.realName) {
                        showMessage('请填写必填字段', 'error');
                        return;
                    }

                    creating.value = true;
                    try {
                        const response = await fetch(`${API_BASE}/api/admin/management/create`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(createForm)
                        });

                        const result = await response.json();
                        
                        if (response.ok && result.code === 200) {
                            showMessage(`管理员 ${result.data.username} 创建成功！`);
                            resetCreateForm();
                            loadAdminList();
                        } else {
                            showMessage(result.message || '创建失败', 'error');
                        }
                    } catch (error) {
                        showMessage('网络错误: ' + error.message, 'error');
                    } finally {
                        creating.value = false;
                    }
                };

                // 重置密码
                const resetPassword = async () => {
                    if (!resetForm.username || !resetForm.newPassword) {
                        showMessage('请填写用户名和新密码', 'error');
                        return;
                    }

                    resetting.value = true;
                    try {
                        const response = await fetch(`${API_BASE}/api/admin/management/reset-password`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(resetForm)
                        });

                        const result = await response.json();
                        
                        if (response.ok && result.code === 200) {
                            showMessage(`用户 ${resetForm.username} 密码重置成功！`);
                            resetForm.username = '';
                            resetForm.newPassword = '';
                        } else {
                            showMessage(result.message || '重置失败', 'error');
                        }
                    } catch (error) {
                        showMessage('网络错误: ' + error.message, 'error');
                    } finally {
                        resetting.value = false;
                    }
                };

                // 生成密码哈希
                const generateHash = async () => {
                    if (!hashForm.password) {
                        showMessage('请输入要生成哈希的密码', 'error');
                        return;
                    }

                    hashing.value = true;
                    try {
                        const response = await fetch(`${API_BASE}/api/admin/management/generate-hash`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ password: hashForm.password })
                        });

                        const result = await response.json();
                        
                        if (response.ok && result.code === 200) {
                            hashResult.value = `密码: ${result.data.password}\n哈希: ${result.data.hash}`;
                            showMessage('密码哈希生成成功！');
                        } else {
                            showMessage(result.message || '生成失败', 'error');
                        }
                    } catch (error) {
                        showMessage('网络错误: ' + error.message, 'error');
                    } finally {
                        hashing.value = false;
                    }
                };

                // 加载管理员列表
                const loadAdminList = async () => {
                    try {
                        const response = await fetch(`${API_BASE}/api/users`);
                        const result = await response.json();
                        
                        if (response.ok && result.code === 200) {
                            adminList.value = result.data.filter(user => user.userType === 'ADMIN');
                            showMessage(`加载到 ${adminList.value.length} 个管理员`);
                        } else {
                            showMessage('加载管理员列表失败', 'error');
                        }
                    } catch (error) {
                        showMessage('网络错误: ' + error.message, 'error');
                    }
                };

                // 快速创建管理员
                const createQuickAdmin = (username, password) => {
                    createForm.username = username;
                    createForm.password = password;
                    createForm.realName = username === 'superadmin' ? '超级管理员' : '系统管理员';
                    createForm.phone = username === 'superadmin' ? '13800000001' : '13800000000';
                    createForm.email = username === 'superadmin' ? 'superadmin@taxi.com' : 'admin@taxi.com';
                    createForm.role = username === 'superadmin' ? 'SUPER_ADMIN' : 'ADMIN';
                    createForm.department = '技术部';
                    createForm.position = username === 'superadmin' ? '超级管理员' : '系统管理员';
                    createForm.permissions = username === 'superadmin' ? 'ALL' : 'USER_MANAGEMENT,ORDER_MANAGEMENT,REVIEW_MANAGEMENT,STATISTICS';
                    createAdmin();
                };

                // 快速重置密码
                const resetQuickPassword = (username, password) => {
                    resetForm.username = username;
                    resetForm.newPassword = password;
                    resetPassword();
                };

                // 重置创建表单
                const resetCreateForm = () => {
                    Object.assign(createForm, {
                        username: '',
                        password: '',
                        realName: '',
                        phone: '',
                        email: '',
                        role: 'ADMIN',
                        department: '',
                        position: '',
                        permissions: 'USER_MANAGEMENT,ORDER_MANAGEMENT,REVIEW_MANAGEMENT,STATISTICS'
                    });
                };

                // 页面加载时获取管理员列表
                onMounted(() => {
                    loadAdminList();
                });

                return {
                    createForm,
                    resetForm,
                    hashForm,
                    creating,
                    resetting,
                    hashing,
                    adminList,
                    successMessage,
                    errorMessage,
                    hashResult,
                    createAdmin,
                    resetPassword,
                    generateHash,
                    loadAdminList,
                    createQuickAdmin,
                    resetQuickPassword,
                    resetCreateForm
                };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>