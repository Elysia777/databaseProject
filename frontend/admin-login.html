<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å‘˜ç™»å½• - ç½‘çº¦è½¦è¿è¥ç³»ç»Ÿ</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Helvetica Neue', Arial, sans-serif;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .login-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            padding: 40px;
            width: 400px;
            max-width: 90vw;
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-title {
            font-size: 28px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        
        .login-subtitle {
            color: #666;
            font-size: 14px;
        }
        
        .login-form {
            margin-top: 30px;
        }
        
        .form-item {
            margin-bottom: 20px;
        }
        
        .login-button {
            width: 100%;
            height: 45px;
            font-size: 16px;
            font-weight: 500;
        }
        
        .admin-info {
            margin-top: 30px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 12px;
            color: #666;
        }
        
        .admin-info h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 14px;
        }
        
        .admin-account {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        
        .quick-login {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        
        .quick-login button {
            flex: 1;
            height: 32px;
            font-size: 12px;
        }
        
        .system-status {
            margin-top: 20px;
            text-align: center;
            font-size: 12px;
            color: #999;
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #52c41a;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="login-container">
            <div class="login-header">
                <div class="login-title">ç®¡ç†å‘˜ç™»å½•</div>
                <div class="login-subtitle">ç½‘çº¦è½¦è¿è¥ç³»ç»Ÿç®¡ç†åå°</div>
            </div>
            
            <el-form 
                ref="loginForm" 
                :model="loginForm" 
                :rules="loginRules" 
                class="login-form"
                @submit.prevent="handleLogin"
            >
                <div class="form-item">
                    <el-form-item prop="username">
                        <el-input
                            v-model="loginForm.username"
                            placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜ç”¨æˆ·å"
                            size="large"
                            prefix-icon="User"
                            :disabled="loading"
                        />
                    </el-form-item>
                </div>
                
                <div class="form-item">
                    <el-form-item prop="password">
                        <el-input
                            v-model="loginForm.password"
                            type="password"
                            placeholder="è¯·è¾“å…¥å¯†ç "
                            size="large"
                            prefix-icon="Lock"
                            :disabled="loading"
                            show-password
                            @keyup.enter="handleLogin"
                        />
                    </el-form-item>
                </div>
                
                <div class="form-item">
                    <el-form-item>
                        <el-checkbox v-model="loginForm.rememberMe" :disabled="loading">
                            è®°ä½æˆ‘
                        </el-checkbox>
                    </el-form-item>
                </div>
                
                <div class="form-item">
                    <el-button 
                        type="primary" 
                        class="login-button"
                        :loading="loading"
                        @click="handleLogin"
                    >
                        {{ loading ? 'ç™»å½•ä¸­...' : 'ç™»å½•' }}
                    </el-button>
                </div>
            </el-form>
            
            <!-- æµ‹è¯•è´¦å·ä¿¡æ¯ -->
            <div class="admin-info">
                <h4>ğŸ”‘ æµ‹è¯•è´¦å·</h4>
                <div class="admin-account">
                    <span><strong>è¶…çº§ç®¡ç†å‘˜:</strong> superadmin / 123456</span>
                </div>
                <div class="admin-account">
                    <span><strong>æ™®é€šç®¡ç†å‘˜:</strong> admin / 123456</span>
                </div>
                
                <div class="quick-login">
                    <el-button size="small" @click="quickLogin('superadmin')">
                        è¶…çº§ç®¡ç†å‘˜ç™»å½•
                    </el-button>
                    <el-button size="small" @click="quickLogin('admin')">
                        æ™®é€šç®¡ç†å‘˜ç™»å½•
                    </el-button>
                </div>
            </div>
            
            <!-- ç³»ç»ŸçŠ¶æ€ -->
            <div class="system-status">
                <span class="status-indicator"></span>
                ç³»ç»Ÿè¿è¡Œæ­£å¸¸
            </div>
        </div>
        
        <!-- ç™»å½•æˆåŠŸåçš„ç®¡ç†å‘˜ä¿¡æ¯å±•ç¤º -->
        <el-dialog
            v-model="showAdminInfo"
            title="ç™»å½•æˆåŠŸ"
            width="500px"
            :close-on-click-modal="false"
        >
            <div v-if="adminInfo">
                <el-descriptions title="ç®¡ç†å‘˜ä¿¡æ¯" :column="2" border>
                    <el-descriptions-item label="ç”¨æˆ·å">{{ adminInfo.username }}</el-descriptions-item>
                    <el-descriptions-item label="çœŸå®å§“å">{{ adminInfo.realName }}</el-descriptions-item>
                    <el-descriptions-item label="è§’è‰²">{{ adminInfo.roleName }}</el-descriptions-item>
                    <el-descriptions-item label="éƒ¨é—¨">{{ adminInfo.department }}</el-descriptions-item>
                    <el-descriptions-item label="èŒä½">{{ adminInfo.position }}</el-descriptions-item>
                    <el-descriptions-item label="æ‰‹æœºå·">{{ adminInfo.phone }}</el-descriptions-item>
                    <el-descriptions-item label="é‚®ç®±">{{ adminInfo.email }}</el-descriptions-item>
                    <el-descriptions-item label="ç™»å½•æ¬¡æ•°">{{ adminInfo.loginCount }}</el-descriptions-item>
                </el-descriptions>
                
                <div style="margin-top: 20px;">
                    <h4>æƒé™åˆ—è¡¨:</h4>
                    <el-tag 
                        v-for="permission in adminPermissions" 
                        :key="permission" 
                        style="margin: 2px;"
                        type="success"
                    >
                        {{ getPermissionName(permission) }}
                    </el-tag>
                </div>
                
                <div style="margin-top: 20px;">
                    <h4>å¯è®¿é—®èœå•:</h4>
                    <el-tag 
                        v-for="menu in adminMenus" 
                        :key="menu.id" 
                        style="margin: 2px;"
                        type="primary"
                    >
                        {{ menu.name }}
                    </el-tag>
                </div>
                
                <div style="margin-top: 20px;">
                    <h4>JWT Token:</h4>
                    <el-input
                        v-model="jwtToken"
                        type="textarea"
                        :rows="3"
                        readonly
                        style="font-family: monospace; font-size: 12px;"
                    />
                </div>
            </div>
            
            <template #footer>
                <el-button @click="showAdminInfo = false">å…³é—­</el-button>
                <el-button type="primary" @click="goToAdminDashboard">è¿›å…¥ç®¡ç†åå°</el-button>
            </template>
        </el-dialog>
    </div>

    <script>
        const { createApp, ref, reactive } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;

        createApp({
            setup() {
                const loginForm = reactive({
                    username: '',
                    password: '',
                    rememberMe: false
                });

                const loginRules = {
                    username: [
                        { required: true, message: 'è¯·è¾“å…¥ç”¨æˆ·å', trigger: 'blur' }
                    ],
                    password: [
                        { required: true, message: 'è¯·è¾“å…¥å¯†ç ', trigger: 'blur' },
                        { min: 6, message: 'å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½', trigger: 'blur' }
                    ]
                };

                const loading = ref(false);
                const showAdminInfo = ref(false);
                const adminInfo = ref(null);
                const adminPermissions = ref([]);
                const adminMenus = ref([]);
                const jwtToken = ref('');

                // å¿«é€Ÿç™»å½•
                const quickLogin = (username) => {
                    loginForm.username = username;
                    loginForm.password = '123456';
                    handleLogin();
                };

                // å¤„ç†ç™»å½•
                const handleLogin = async () => {
                    if (!loginForm.username || !loginForm.password) {
                        ElMessage.warning('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ');
                        return;
                    }

                    loading.value = true;

                    try {
                        const response = await fetch('http://localhost:8080/api/admin/auth/login', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(loginForm)
                        });

                        const result = await response.json();
                        console.log('ç™»å½•å“åº”:', result);

                        if (response.ok && result.code === 200) {
                            ElMessage.success('ç™»å½•æˆåŠŸï¼');
                            
                            // ä¿å­˜ç™»å½•ä¿¡æ¯
                            const loginData = result.data;
                            adminInfo.value = loginData.adminInfo;
                            adminPermissions.value = loginData.permissions || [];
                            adminMenus.value = loginData.menus || [];
                            jwtToken.value = loginData.token;
                            
                            // ä¿å­˜åˆ°localStorage
                            if (loginForm.rememberMe) {
                                localStorage.setItem('admin_token', loginData.token);
                                localStorage.setItem('admin_info', JSON.stringify(loginData.adminInfo));
                            }
                            
                            // æ˜¾ç¤ºç®¡ç†å‘˜ä¿¡æ¯
                            showAdminInfo.value = true;
                            
                        } else {
                            ElMessage.error(result.message || 'ç™»å½•å¤±è´¥');
                        }

                    } catch (error) {
                        console.error('ç™»å½•é”™è¯¯:', error);
                        ElMessage.error('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨è¿æ¥');
                    } finally {
                        loading.value = false;
                    }
                };

                // è·å–æƒé™åç§°
                const getPermissionName = (permission) => {
                    const permissionMap = {
                        'ALL': 'æ‰€æœ‰æƒé™',
                        'USER_MANAGEMENT': 'ç”¨æˆ·ç®¡ç†',
                        'ORDER_MANAGEMENT': 'è®¢å•ç®¡ç†',
                        'REVIEW_MANAGEMENT': 'è¯„ä»·ç®¡ç†',
                        'STATISTICS': 'æ•°æ®ç»Ÿè®¡',
                        'SYSTEM_MONITOR': 'ç³»ç»Ÿç›‘æ§'
                    };
                    return permissionMap[permission] || permission;
                };

                // è¿›å…¥ç®¡ç†åå°
                const goToAdminDashboard = () => {
                    ElMessage.success('æ­£åœ¨è·³è½¬åˆ°ç®¡ç†åå°...');
                    // è·³è½¬åˆ°ç®¡ç†åå°ä»ªè¡¨æ¿
                    setTimeout(() => {
                        window.location.href = 'admin-dashboard.html';
                    }, 1000);
                };

                return {
                    loginForm,
                    loginRules,
                    loading,
                    showAdminInfo,
                    adminInfo,
                    adminPermissions,
                    adminMenus,
                    jwtToken,
                    quickLogin,
                    handleLogin,
                    getPermissionName,
                    goToAdminDashboard
                };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>