<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>乘客端司机信息显示测试</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus@2.4.4/dist/index.full.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus@2.4.4/dist/index.css">
    <style>
        body {
            font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            margin: 0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        .test-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 30px;
        }
        .demo-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            background: #fafafa;
        }
        .demo-section h3 {
            margin-top: 0;
            color: #1f2937;
        }
        
        /* 复制乘客地图页面的司机信息样式 */
        .enhanced-driver-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 16px;
            padding: 20px;
            margin-top: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .driver-card {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .driver-avatar {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
        }

        .driver-avatar img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid #fff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            object-fit: cover;
        }

        .driver-details {
            text-align: center;
            margin-bottom: 15px;
        }

        .driver-details .driver-name {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .driver-rating {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .rating-stars {
            display: flex;
            gap: 2px;
        }

        .star {
            color: #ddd;
            font-size: 14px;
            transition: color 0.2s ease;
        }

        .star.filled {
            color: #ffd700;
        }

        .rating-score {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .driver-details .driver-phone {
            font-size: 14px;
            color: #7f8c8d;
            font-weight: 500;
        }

        .vehicle-details {
            background: #fff;
            border-radius: 12px;
            padding: 15px;
            border: 1px solid #e9ecef;
        }

        .vehicle-info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .vehicle-brand {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
        }

        .vehicle-color {
            font-size: 14px;
            color: #7f8c8d;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 6px;
        }

        .vehicle-plate {
            text-align: center;
            margin: 15px 0;
        }

        .plate-number {
            display: inline-block;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            font-weight: 700;
            color: #2c3e50;
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            padding: 8px 16px;
            border-radius: 8px;
            border: 2px solid #3498db;
            letter-spacing: 2px;
            box-shadow: 0 2px 4px rgba(52, 152, 219, 0.2);
        }

        .vehicle-type {
            text-align: center;
            font-size: 14px;
            color: #7f8c8d;
            background: #e8f4fd;
            padding: 6px 12px;
            border-radius: 20px;
            display: inline-block;
            width: 100%;
            box-sizing: border-box;
        }

        .driver-actions {
            display: flex;
            justify-content: center;
            margin-top: 15px;
        }

        .driver-actions .el-button {
            border-radius: 20px;
            padding: 10px 20px;
            font-weight: 500;
        }
        
        .test-button {
            display: inline-block;
            padding: 12px 24px;
            background: #3b82f6;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
            border: none;
            cursor: pointer;
        }
        
        .test-button:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }
        
        .test-button.primary {
            background: #667eea;
            font-size: 16px;
            padding: 15px 30px;
        }
        
        .test-button.primary:hover {
            background: #5a67d8;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <div class="test-banner">
                <h1 style="margin: 0; font-size: 28px;">🚗 乘客端司机信息显示</h1>
                <p style="margin: 10px 0 0 0; font-size: 16px;">测试司机头像、车型、车牌号显示效果</p>
            </div>
            
            <div class="demo-section">
                <h3>📋 功能说明</h3>
                <p>乘客端现在会显示以下司机信息：</p>
                <ul>
                    <li><strong>司机头像：</strong> 显示司机的个人头像，如果没有则生成默认头像</li>
                    <li><strong>司机姓名：</strong> 显示司机的真实姓名</li>
                    <li><strong>司机评分：</strong> 显示司机的星级评分</li>
                    <li><strong>联系电话：</strong> 显示司机的联系方式</li>
                    <li><strong>车辆品牌型号：</strong> 显示车辆的品牌和型号</li>
                    <li><strong>车牌号：</strong> 特殊样式显示车牌号码</li>
                    <li><strong>车辆颜色：</strong> 显示车辆颜色</li>
                    <li><strong>车辆类型：</strong> 显示车辆类型（经济型、舒适型等）</li>
                    <li><strong>拨打电话：</strong> 点击按钮可以直接拨打司机电话</li>
                </ul>
            </div>

            <div class="demo-section">
                <h3>🎨 司机信息显示效果演示</h3>
                
                <!-- 示例1：完整信息的司机 -->
                <div class="enhanced-driver-info">
                    <div class="driver-card">
                        <div class="driver-avatar">
                            <img :src="demoDriver1.avatar" :alt="demoDriver1.name" />
                        </div>
                        
                        <div class="driver-details">
                            <div class="driver-name">{{ demoDriver1.name }}</div>
                            <div class="driver-rating">
                                <span class="rating-stars">
                                    <span v-for="i in 5" :key="i" class="star" :class="{ filled: i <= Math.floor(demoDriver1.rating) }">★</span>
                                </span>
                                <span class="rating-score">{{ demoDriver1.rating.toFixed(1) }}</span>
                            </div>
                            <div class="driver-phone">{{ demoDriver1.phone }}</div>
                        </div>
                        
                        <div class="vehicle-details">
                            <div class="vehicle-info-row">
                                <div class="vehicle-brand">{{ demoDriver1.vehicleBrand }} {{ demoDriver1.vehicleModel }}</div>
                                <div class="vehicle-color">{{ demoDriver1.vehicleColor }}</div>
                            </div>
                            <div class="vehicle-plate">
                                <span class="plate-number">{{ demoDriver1.plateNumber }}</span>
                            </div>
                            <div class="vehicle-type">{{ getVehicleTypeText(demoDriver1.vehicleType) }}</div>
                        </div>
                        
                        <div class="driver-actions">
                            <el-button type="primary" size="small" @click="callDriver(demoDriver1)">
                                📞 拨打电话
                            </el-button>
                        </div>
                    </div>
                </div>

                <br>

                <!-- 示例2：另一个司机 -->
                <div class="enhanced-driver-info">
                    <div class="driver-card">
                        <div class="driver-avatar">
                            <img :src="demoDriver2.avatar" :alt="demoDriver2.name" />
                        </div>
                        
                        <div class="driver-details">
                            <div class="driver-name">{{ demoDriver2.name }}</div>
                            <div class="driver-rating">
                                <span class="rating-stars">
                                    <span v-for="i in 5" :key="i" class="star" :class="{ filled: i <= Math.floor(demoDriver2.rating) }">★</span>
                                </span>
                                <span class="rating-score">{{ demoDriver2.rating.toFixed(1) }}</span>
                            </div>
                            <div class="driver-phone">{{ demoDriver2.phone }}</div>
                        </div>
                        
                        <div class="vehicle-details">
                            <div class="vehicle-info-row">
                                <div class="vehicle-brand">{{ demoDriver2.vehicleBrand }} {{ demoDriver2.vehicleModel }}</div>
                                <div class="vehicle-color">{{ demoDriver2.vehicleColor }}</div>
                            </div>
                            <div class="vehicle-plate">
                                <span class="plate-number">{{ demoDriver2.plateNumber }}</span>
                            </div>
                            <div class="vehicle-type">{{ getVehicleTypeText(demoDriver2.vehicleType) }}</div>
                        </div>
                        
                        <div class="driver-actions">
                            <el-button type="primary" size="small" @click="callDriver(demoDriver2)">
                                📞 拨打电话
                            </el-button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="demo-section">
                <h3>🔧 技术实现</h3>
                <p><strong>后端改进：</strong></p>
                <ul>
                    <li>WebSocket通知服务中添加了车辆信息查询</li>
                    <li>通过VehicleMapper获取司机的激活车辆信息</li>
                    <li>返回完整的车辆详细信息（品牌、型号、颜色、车牌号等）</li>
                </ul>
                
                <p><strong>前端改进：</strong></p>
                <ul>
                    <li>增强的司机信息显示组件</li>
                    <li>美观的车牌号特殊样式</li>
                    <li>司机头像显示和默认头像生成</li>
                    <li>星级评分显示</li>
                    <li>一键拨打电话功能</li>
                </ul>
            </div>

            <div class="demo-section">
                <h3>🧪 测试步骤</h3>
                <ol>
                    <li><strong>司机端：</strong> 确保司机已添加车辆信息并设置为激活状态</li>
                    <li><strong>乘客端：</strong> 创建订单并等待司机接单</li>
                    <li><strong>验证显示：</strong> 订单被接单后，检查司机信息是否正确显示</li>
                    <li><strong>功能测试：</strong> 测试拨打电话功能是否正常</li>
                </ol>
                
                <div style="text-align: center; margin: 20px 0;">
                    <a href="http://localhost:3000/dashboard/passenger-map" target="_blank" class="test-button primary">
                        🚗 测试乘客端地图
                    </a>
                    <a href="http://localhost:3000/dashboard/vehicles" target="_blank" class="test-button">
                        🔧 司机车辆管理
                    </a>
                </div>
            </div>

            <div style="margin-top: 30px; padding: 25px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white; text-align: center;">
                <h3 style="color: white; margin-bottom: 15px;">✨ 功能已完成</h3>
                <p style="color: white; margin-bottom: 20px; font-size: 16px;">
                    乘客端现在可以看到司机的详细信息，包括头像、车型、车牌号等
                </p>
                <p style="color: white; margin: 0; font-size: 14px;">
                    这将帮助乘客更好地识别司机和车辆，提升用户体验
                </p>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, reactive } = Vue;
        const { ElMessage } = ElementPlus;

        createApp({
            setup() {
                // 演示数据
                const demoDriver1 = reactive({
                    name: '张师傅',
                    phone: '138****8888',
                    rating: 4.8,
                    avatar: getDefaultAvatar('张师傅'),
                    vehicleBrand: '丰田',
                    vehicleModel: '凯美瑞',
                    vehicleColor: '白色',
                    plateNumber: '京A12345',
                    vehicleType: 'COMFORT'
                });

                const demoDriver2 = reactive({
                    name: '李师傅',
                    phone: '139****9999',
                    rating: 4.9,
                    avatar: getDefaultAvatar('李师傅'),
                    vehicleBrand: '本田',
                    vehicleModel: '雅阁',
                    vehicleColor: '黑色',
                    plateNumber: '京B67890',
                    vehicleType: 'PREMIUM'
                });

                // 获取默认头像
                function getDefaultAvatar(name) {
                    const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8'];
                    const colorIndex = name ? name.charCodeAt(0) % colors.length : 0;
                    const backgroundColor = colors[colorIndex];
                    const firstChar = name ? name.charAt(0).toUpperCase() : '司';
                    
                    const svg = `
                        <svg width="60" height="60" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="30" cy="30" r="30" fill="${backgroundColor}"/>
                            <text x="30" y="38" text-anchor="middle" fill="white" font-size="20" font-weight="bold">${firstChar}</text>
                        </svg>
                    `;
                    
                    return `data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(svg)))}`;
                }

                // 获取车辆类型文本
                const getVehicleTypeText = (type) => {
                    const typeMap = {
                        'ECONOMY': '经济型',
                        'COMFORT': '舒适型',
                        'PREMIUM': '高级型',
                        'LUXURY': '豪华型'
                    };
                    return typeMap[type] || '经济型';
                };

                // 拨打司机电话
                const callDriver = (driver) => {
                    ElMessage.info(`拨打电话：${driver.phone}`);
                    // 在实际应用中，这里会调用电话功能
                    if (/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                        // 移动设备上直接拨打
                        // window.location.href = `tel:${driver.phone}`;
                        ElMessage.success('正在拨打电话...');
                    } else {
                        // 桌面设备上复制到剪贴板
                        if (navigator.clipboard) {
                            navigator.clipboard.writeText(driver.phone).then(() => {
                                ElMessage.success('电话号码已复制到剪贴板');
                            });
                        }
                    }
                };

                return {
                    demoDriver1,
                    demoDriver2,
                    getVehicleTypeText,
                    callDriver
                };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>