<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹˜å®¢ç«¯åœ°å›¾ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #409eff 0%, #337ecc 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .content {
            padding: 20px;
        }
        
        .fix-section {
            margin-bottom: 25px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #fafafa;
        }
        
        .fix-section h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 16px;
        }
        
        .problem-card {
            background: #fef2f2;
            border: 1px solid #fca5a5;
            border-radius: 4px;
            padding: 12px;
            margin: 10px 0;
            color: #dc2626;
        }
        
        .solution-card {
            background: #f0f9ff;
            border: 1px solid #7dd3fc;
            border-radius: 4px;
            padding: 12px;
            margin: 10px 0;
            color: #0369a1;
        }
        
        .code-block {
            background: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            margin: 10px 0;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        
        .test-button {
            background: #409eff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 12px;
        }
        
        .test-button:hover {
            background: #337ecc;
        }
        
        .test-button.success {
            background: #67c23a;
        }
        
        .test-button.success:hover {
            background: #5daf34;
        }
        
        .test-button.warning {
            background: #e6a23c;
        }
        
        .test-button.warning:hover {
            background: #cf9236;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ—ºï¸ ä¹˜å®¢ç«¯åœ°å›¾ä¿®å¤æµ‹è¯•</h1>
            <p>ä¿®å¤é¡µé¢åˆ‡æ¢ã€è®¢å•å–æ¶ˆå’Œå¸æœºä½ç½®æ›´æ–°çš„é—®é¢˜</p>
        </div>
        
        <div class="content">
            <!-- é—®é¢˜1: é¡µé¢åˆ‡æ¢åæ ‡è®°æ¶ˆå¤± -->
            <div class="fix-section">
                <h3>ğŸ”§ ä¿®å¤1: é¡µé¢åˆ‡æ¢åèµ·å§‹ç‚¹å’Œç»ˆç‚¹å›¾æ ‡æ¶ˆå¤±</h3>
                
                <div class="problem-card">
                    <strong>é—®é¢˜æè¿°:</strong><br>
                    ä»å…¶ä»–é¡µé¢åˆ‡æ¢å›ä¹˜å®¢åœ°å›¾é¡µé¢æ—¶ï¼Œä¸Šè½¦ç‚¹å’Œç›®çš„åœ°æ ‡è®°æ¶ˆå¤±ï¼Œåªå‰©ä¸‹è·¯çº¿ã€‚
                </div>
                
                <div class="solution-card">
                    <strong>è§£å†³æ–¹æ¡ˆ:</strong><br>
                    åœ¨é¡µé¢æ¿€æ´»æ—¶æ£€æŸ¥å¹¶æ¢å¤æ‰€æœ‰åœ°å›¾æ ‡è®°ï¼Œç¡®ä¿æ ‡è®°çŠ¶æ€ä¸è®¢å•çŠ¶æ€ä¸€è‡´ã€‚
                </div>
                
                <div class="code-block">// ä¿®å¤ä»£ç  - åœ¨initializePassengerMapä¸­æ·»åŠ æ ‡è®°æ¢å¤é€»è¾‘
const restoreMapMarkers = () => {
  console.log('ğŸ”„ æ¢å¤åœ°å›¾æ ‡è®°...');
  
  // æ¢å¤ä¸Šè½¦ç‚¹æ ‡è®°
  if (currentPosition.value && !pickupMarker) {
    pickupMarker = new window.AMap.Marker({
      position: [currentPosition.value.lng, currentPosition.value.lat],
      map,
      icon: new window.AMap.Icon({
        image: 'https://webapi.amap.com/theme/v1.3/markers/n/start.png',
        size: new window.AMap.Size(25, 34),
        imageSize: new window.AMap.Size(25, 34)
      }),
      title: 'ä¸Šè½¦ç‚¹',
      draggable: !currentOrder.value
    });
    
    // é‡æ–°ç»‘å®šæ‹–æ‹½äº‹ä»¶
    pickupMarker.on("dragend", handlePickupDrag);
  }
  
  // æ¢å¤ç›®çš„åœ°æ ‡è®°
  if (destinationPosition.value && !destMarker) {
    destMarker = new window.AMap.Marker({
      position: [destinationPosition.value.lng, destinationPosition.value.lat],
      map,
      icon: new window.AMap.Icon({
        image: 'https://webapi.amap.com/theme/v1.3/markers/n/end.png',
        size: new window.AMap.Size(25, 34),
        imageSize: new window.AMap.Size(25, 34)
      }),
      title: 'ç›®çš„åœ°'
    });
  }
  
  // æ¢å¤å¸æœºæ ‡è®°ï¼ˆå¦‚æœæœ‰å½“å‰è®¢å•ï¼‰
  if (currentOrder.value && driverInfo.value && !driverMarker) {
    driverMarker = new window.AMap.Marker({
      position: [driverInfo.value.longitude, driverInfo.value.latitude],
      map,
      icon: new window.AMap.Icon({
        image: 'https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
        size: new window.AMap.Size(25, 34),
        imageSize: new window.AMap.Size(25, 34)
      }),
      title: 'å¸æœºä½ç½®'
    });
  }
  
  console.log('âœ… åœ°å›¾æ ‡è®°æ¢å¤å®Œæˆ');
};</div>
                
                <button class="test-button" onclick="testMarkerRestore()">æµ‹è¯•æ ‡è®°æ¢å¤</button>
            </div>
            
            <!-- é—®é¢˜2: è®¢å•å–æ¶ˆåè·¯å¾„æ²¡æœ‰æ¸…é™¤ -->
            <div class="fix-section">
                <h3>ğŸ”§ ä¿®å¤2: å–æ¶ˆè®¢å•åæ—§è·¯å¾„æ²¡æœ‰æ¸…é™¤</h3>
                
                <div class="problem-card">
                    <strong>é—®é¢˜æè¿°:</strong><br>
                    å–æ¶ˆè®¢å•åï¼Œåœ°å›¾ä¸Šä»ç„¶æ˜¾ç¤ºå¸æœºè·¯å¾„å’Œä¹˜å®¢è·¯å¾„ï¼Œæ²¡æœ‰è¢«æ¸…ç†å¹²å‡€ã€‚
                </div>
                
                <div class="solution-card">
                    <strong>è§£å†³æ–¹æ¡ˆ:</strong><br>
                    å¢å¼ºresetOrderStateå‡½æ•°ï¼Œç¡®ä¿æ¸…ç†æ‰€æœ‰è·¯å¾„å’Œå¸æœºç›¸å…³æ ‡è®°ã€‚
                </div>
                
                <div class="code-block">// ä¿®å¤ä»£ç  - å¢å¼ºresetOrderStateå‡½æ•°
const resetOrderState = () => {
  console.log("ğŸ”„ é‡ç½®è®¢å•çŠ¶æ€");

  orderStore.clearOrderState();
  stopDriverTracking();

  // æ¸…ç†å¸æœºæ ‡è®°
  if (driverMarker) {
    map.remove(driverMarker);
    driverMarker = null;
    console.log('ğŸ—‘ï¸ å·²æ¸…ç†å¸æœºæ ‡è®°');
  }

  // æ¸…ç†å¸æœºè·¯å¾„
  if (window.driverRouteLine) {
    map.remove(window.driverRouteLine);
    window.driverRouteLine = null;
    console.log('ğŸ—‘ï¸ å·²æ¸…ç†å¸æœºè·¯å¾„');
  }

  // æ¸…ç†æ‰€æœ‰çº¢è‰²è·¯å¾„ï¼ˆå¸æœºè·¯å¾„ï¼‰
  const allOverlays = map.getAllOverlays();
  allOverlays.forEach(overlay => {
    if (overlay.CLASS_NAME === 'AMap.Polyline') {
      try {
        const options = overlay.getOptions();
        if (options && options.strokeColor === '#FF6B6B') {
          map.remove(overlay);
          console.log('ğŸ—‘ï¸ æ¸…ç†äº†çº¢è‰²å¸æœºè·¯å¾„');
        }
      } catch (error) {
        // å¿½ç•¥é”™è¯¯
      }
    }
  });

  // æ¢å¤ä¹˜å®¢è·¯å¾„ä¸ºè“è‰²
  if (routeLine) {
    routeLine.setOptions({
      strokeColor: "#409EFF",
      strokeWeight: 6,
      strokeOpacity: 0.8,
    });
    console.log('ğŸ”„ ä¹˜å®¢è·¯å¾„å·²æ¢å¤ä¸ºè“è‰²');
  }

  // é‡ç½®çŠ¶æ€
  window.routeInitialized = false;
  canOrder.value = true;
  isCalling.value = false;

  // æ¢å¤ä¸Šè½¦ç‚¹æ ‡è®°çš„å¯æ‹–æ‹½çŠ¶æ€
  updatePickupMarkerDraggable();

  // é‡æ–°æ£€æŸ¥æœªæ”¯ä»˜è®¢å•
  orderStore.checkUnpaidOrders();
  
  console.log('âœ… è®¢å•çŠ¶æ€é‡ç½®å®Œæˆ');
};</div>
                
                <button class="test-button" onclick="testOrderReset()">æµ‹è¯•è®¢å•é‡ç½®</button>
            </div>
            
            <!-- é—®é¢˜3: å¸æœºä½ç½®æ›´æ–°åæ—§è·¯å¾„æ²¡æœ‰æ¸…é™¤ -->
            <div class="fix-section">
                <h3>ğŸ”§ ä¿®å¤3: å¸æœºä½ç½®æ›´æ–°åæ—§è·¯å¾„æ²¡æœ‰æ¸…é™¤</h3>
                
                <div class="problem-card">
                    <strong>é—®é¢˜æè¿°:</strong><br>
                    å¸æœºä½ç½®æ›´æ–°æ—¶ï¼Œæ—§çš„å¸æœºè·¯å¾„æ²¡æœ‰è¢«æ¸…é™¤ï¼Œå¯¼è‡´åœ°å›¾ä¸Šå‡ºç°å¤šæ¡è·¯å¾„ã€‚
                </div>
                
                <div class="solution-card">
                    <strong>è§£å†³æ–¹æ¡ˆ:</strong><br>
                    åœ¨å¸æœºä½ç½®æ›´æ–°æ—¶ï¼Œå…ˆæ¸…é™¤æ‰€æœ‰æ—§çš„å¸æœºè·¯å¾„ï¼Œå†è§„åˆ’æ–°è·¯å¾„ã€‚
                </div>
                
                <div class="code-block">// ä¿®å¤ä»£ç  - å¢å¼ºå¸æœºä½ç½®æ›´æ–°å¤„ç†
const updateDriverLocation = (data) => {
  console.log("ğŸ“ æ›´æ–°å¸æœºä½ç½®:", data);

  // å…ˆæ¸…ç†æ‰€æœ‰æ—§çš„å¸æœºè·¯å¾„
  clearAllDriverRoutes();

  // æ›´æ–°å¸æœºæ ‡è®°ä½ç½®
  if (driverMarker) {
    driverMarker.setPosition([data.longitude, data.latitude]);
    driverMarker.setAnimation("AMAP_ANIMATION_BOUNCE");
    setTimeout(() => {
      if (driverMarker) {
        driverMarker.setAnimation("AMAP_ANIMATION_NONE");
      }
    }, 1000);
  } else {
    // åˆ›å»ºå¸æœºæ ‡è®°
    driverMarker = new window.AMap.Marker({
      position: [data.longitude, data.latitude],
      map,
      icon: new window.AMap.Icon({
        image: 'https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
        size: new window.AMap.Size(25, 34),
        imageSize: new window.AMap.Size(25, 34)
      }),
      title: 'å¸æœºä½ç½®'
    });
  }

  // æ ¹æ®è®¢å•çŠ¶æ€è§„åˆ’æ–°è·¯å¾„
  if (currentOrder.value) {
    if (currentOrder.value.status === 'ASSIGNED' || currentOrder.value.status === 'PICKUP') {
      // å¸æœºå‰å¾€ä¸Šè½¦ç‚¹
      updateDriverRoute(
        data.longitude, data.latitude,
        currentOrder.value.pickupLongitude, currentOrder.value.pickupLatitude
      );
    } else if (currentOrder.value.status === 'IN_PROGRESS') {
      // å¸æœºå‰å¾€ç›®çš„åœ°
      updateDriverRoute(
        data.longitude, data.latitude,
        currentOrder.value.destinationLongitude, currentOrder.value.destinationLatitude
      );
    }
  }
};

// æ¸…ç†æ‰€æœ‰å¸æœºè·¯å¾„çš„å‡½æ•°
const clearAllDriverRoutes = () => {
  console.log('ğŸ§¹ æ¸…ç†æ‰€æœ‰å¸æœºè·¯å¾„...');
  
  // æ¸…ç†å…¨å±€å¸æœºè·¯å¾„å˜é‡
  if (window.driverRouteLine) {
    map.remove(window.driverRouteLine);
    window.driverRouteLine = null;
  }
  
  // æ¸…ç†æ‰€æœ‰çº¢è‰²è·¯å¾„
  const allOverlays = map.getAllOverlays();
  let cleanedCount = 0;
  
  allOverlays.forEach(overlay => {
    if (overlay.CLASS_NAME === 'AMap.Polyline') {
      try {
        const options = overlay.getOptions();
        if (options && options.strokeColor === '#FF6B6B') {
          map.remove(overlay);
          cleanedCount++;
        }
      } catch (error) {
        // å¿½ç•¥é”™è¯¯
      }
    }
  });
  
  console.log(`ğŸ—‘ï¸ æ¸…ç†äº† ${cleanedCount} æ¡å¸æœºè·¯å¾„`);
};</div>
                
                <button class="test-button" onclick="testDriverLocationUpdate()">æµ‹è¯•å¸æœºä½ç½®æ›´æ–°</button>
            </div>
            
            <!-- ç»¼åˆæµ‹è¯• -->
            <div class="fix-section">
                <h3>ğŸ§ª ç»¼åˆæµ‹è¯•</h3>
                
                <div class="solution-card">
                    <strong>æµ‹è¯•åœºæ™¯:</strong><br>
                    1. é¡µé¢åˆ‡æ¢æµ‹è¯• - åˆ‡æ¢åˆ°å…¶ä»–é¡µé¢å†å›æ¥<br>
                    2. è®¢å•å–æ¶ˆæµ‹è¯• - å–æ¶ˆè®¢å•åæ£€æŸ¥è·¯å¾„æ¸…ç†<br>
                    3. å¸æœºä½ç½®æ›´æ–°æµ‹è¯• - æ¨¡æ‹Ÿå¸æœºä½ç½®å˜åŒ–<br>
                    4. ç»¼åˆåœºæ™¯æµ‹è¯• - ç»„åˆå¤šä¸ªæ“ä½œ
                </div>
                
                <button class="test-button success" onclick="runComprehensiveTest()">è¿è¡Œç»¼åˆæµ‹è¯•</button>
                <button class="test-button warning" onclick="simulatePageSwitch()">æ¨¡æ‹Ÿé¡µé¢åˆ‡æ¢</button>
                <button class="test-button warning" onclick="simulateOrderCancel()">æ¨¡æ‹Ÿè®¢å•å–æ¶ˆ</button>
                <button class="test-button warning" onclick="simulateDriverMove()">æ¨¡æ‹Ÿå¸æœºç§»åŠ¨</button>
            </div>
            
            <!-- è°ƒè¯•å·¥å…· -->
            <div class="fix-section">
                <h3>ğŸ”§ è°ƒè¯•å·¥å…·</h3>
                
                <button class="test-button" onclick="checkMapState()">æ£€æŸ¥åœ°å›¾çŠ¶æ€</button>
                <button class="test-button" onclick="listAllOverlays()">åˆ—å‡ºæ‰€æœ‰è¦†ç›–ç‰©</button>
                <button class="test-button" onclick="forceCleanMap()">å¼ºåˆ¶æ¸…ç†åœ°å›¾</button>
                
                <div id="debugOutput" class="code-block" style="display: none; margin-top: 10px;">
                    è°ƒè¯•ä¿¡æ¯å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
                </div>
            </div>
        </div>
    </div>

    <script>
        // æµ‹è¯•å‡½æ•°
        function testMarkerRestore() {
            console.log('ğŸ§ª æµ‹è¯•æ ‡è®°æ¢å¤åŠŸèƒ½');
            
            // æ£€æŸ¥æ ‡è®°æ˜¯å¦å­˜åœ¨
            const markers = {
                pickup: window.pickupMarker,
                destination: window.destMarker,
                driver: window.driverMarker
            };
            
            console.log('å½“å‰æ ‡è®°çŠ¶æ€:', markers);
            
            // å¦‚æœæœ‰æ¢å¤å‡½æ•°ï¼Œè°ƒç”¨å®ƒ
            if (typeof window.restoreMapMarkers === 'function') {
                window.restoreMapMarkers();
                console.log('âœ… æ ‡è®°æ¢å¤å‡½æ•°å·²è°ƒç”¨');
            } else {
                console.log('âŒ æ ‡è®°æ¢å¤å‡½æ•°ä¸å­˜åœ¨');
            }
        }
        
        function testOrderReset() {
            console.log('ğŸ§ª æµ‹è¯•è®¢å•é‡ç½®åŠŸèƒ½');
            
            // å¦‚æœæœ‰é‡ç½®å‡½æ•°ï¼Œè°ƒç”¨å®ƒ
            if (typeof window.resetOrderState === 'function') {
                window.resetOrderState();
                console.log('âœ… è®¢å•é‡ç½®å‡½æ•°å·²è°ƒç”¨');
            } else {
                console.log('âŒ è®¢å•é‡ç½®å‡½æ•°ä¸å­˜åœ¨');
            }
        }
        
        function testDriverLocationUpdate() {
            console.log('ğŸ§ª æµ‹è¯•å¸æœºä½ç½®æ›´æ–°åŠŸèƒ½');
            
            // æ¨¡æ‹Ÿå¸æœºä½ç½®æ•°æ®
            const mockDriverData = {
                longitude: 116.397428 + (Math.random() - 0.5) * 0.01,
                latitude: 39.90923 + (Math.random() - 0.5) * 0.01,
                timestamp: Date.now()
            };
            
            console.log('æ¨¡æ‹Ÿå¸æœºä½ç½®:', mockDriverData);
            
            // å¦‚æœæœ‰ä½ç½®æ›´æ–°å‡½æ•°ï¼Œè°ƒç”¨å®ƒ
            if (typeof window.updateDriverLocation === 'function') {
                window.updateDriverLocation(mockDriverData);
                console.log('âœ… å¸æœºä½ç½®æ›´æ–°å‡½æ•°å·²è°ƒç”¨');
            } else {
                console.log('âŒ å¸æœºä½ç½®æ›´æ–°å‡½æ•°ä¸å­˜åœ¨');
            }
        }
        
        function runComprehensiveTest() {
            console.log('ğŸ§ª å¼€å§‹ç»¼åˆæµ‹è¯•');
            
            // æµ‹è¯•åºåˆ—
            const tests = [
                { name: 'æ ‡è®°æ¢å¤', func: testMarkerRestore, delay: 0 },
                { name: 'å¸æœºä½ç½®æ›´æ–°', func: testDriverLocationUpdate, delay: 2000 },
                { name: 'è®¢å•é‡ç½®', func: testOrderReset, delay: 4000 },
                { name: 'åœ°å›¾çŠ¶æ€æ£€æŸ¥', func: checkMapState, delay: 6000 }
            ];
            
            tests.forEach(test => {
                setTimeout(() => {
                    console.log(`ğŸ”„ æ‰§è¡Œæµ‹è¯•: ${test.name}`);
                    test.func();
                }, test.delay);
            });
            
            setTimeout(() => {
                console.log('âœ… ç»¼åˆæµ‹è¯•å®Œæˆ');
            }, 8000);
        }
        
        function simulatePageSwitch() {
            console.log('ğŸ§ª æ¨¡æ‹Ÿé¡µé¢åˆ‡æ¢');
            
            // æ¨¡æ‹Ÿé¡µé¢å¤±æ´»
            console.log('ğŸ“± æ¨¡æ‹Ÿé¡µé¢å¤±æ´»...');
            
            // å»¶è¿Ÿæ¨¡æ‹Ÿé¡µé¢æ¿€æ´»
            setTimeout(() => {
                console.log('ğŸ“± æ¨¡æ‹Ÿé¡µé¢æ¿€æ´»...');
                
                // å¦‚æœæœ‰åˆå§‹åŒ–å‡½æ•°ï¼Œè°ƒç”¨å®ƒ
                if (typeof window.initializePassengerMap === 'function') {
                    window.initializePassengerMap(true);
                    console.log('âœ… é¡µé¢é‡æ–°æ¿€æ´»å®Œæˆ');
                } else {
                    console.log('âŒ é¡µé¢åˆå§‹åŒ–å‡½æ•°ä¸å­˜åœ¨');
                }
            }, 1000);
        }
        
        function simulateOrderCancel() {
            console.log('ğŸ§ª æ¨¡æ‹Ÿè®¢å•å–æ¶ˆ');
            
            // å…ˆåˆ›å»ºä¸€äº›æµ‹è¯•è·¯å¾„
            console.log('ğŸ“ åˆ›å»ºæµ‹è¯•è·¯å¾„...');
            
            // å»¶è¿Ÿæ‰§è¡Œå–æ¶ˆ
            setTimeout(() => {
                testOrderReset();
                console.log('âœ… è®¢å•å–æ¶ˆæ¨¡æ‹Ÿå®Œæˆ');
            }, 1000);
        }
        
        function simulateDriverMove() {
            console.log('ğŸ§ª æ¨¡æ‹Ÿå¸æœºç§»åŠ¨');
            
            // è¿ç»­æ›´æ–°å¸æœºä½ç½®
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    testDriverLocationUpdate();
                }, i * 1000);
            }
        }
        
        function checkMapState() {
            console.log('ğŸ” æ£€æŸ¥åœ°å›¾çŠ¶æ€');
            
            const state = {
                mapExists: !!window.map,
                pickupMarker: !!window.pickupMarker,
                destMarker: !!window.destMarker,
                driverMarker: !!window.driverMarker,
                routeLine: !!window.routeLine,
                driverRouteLine: !!window.driverRouteLine,
                currentOrder: !!window.currentOrder?.value
            };
            
            console.log('åœ°å›¾çŠ¶æ€:', state);
            
            const output = document.getElementById('debugOutput');
            output.style.display = 'block';
            output.textContent = JSON.stringify(state, null, 2);
        }
        
        function listAllOverlays() {
            console.log('ğŸ“‹ åˆ—å‡ºæ‰€æœ‰è¦†ç›–ç‰©');
            
            if (window.map && window.map.getAllOverlays) {
                const overlays = window.map.getAllOverlays();
                console.log(`æ€»è¦†ç›–ç‰©æ•°é‡: ${overlays.length}`);
                
                const overlayInfo = overlays.map((overlay, index) => {
                    try {
                        const info = {
                            index: index,
                            type: overlay.CLASS_NAME,
                            options: overlay.getOptions ? overlay.getOptions() : 'N/A'
                        };
                        return info;
                    } catch (error) {
                        return { index: index, type: 'Unknown', error: error.message };
                    }
                });
                
                console.log('è¦†ç›–ç‰©è¯¦æƒ…:', overlayInfo);
                
                const output = document.getElementById('debugOutput');
                output.style.display = 'block';
                output.textContent = JSON.stringify(overlayInfo, null, 2);
            } else {
                console.log('âŒ åœ°å›¾å¯¹è±¡ä¸å­˜åœ¨æˆ–ä¸æ”¯æŒgetAllOverlays');
            }
        }
        
        function forceCleanMap() {
            console.log('ğŸ§¹ å¼ºåˆ¶æ¸…ç†åœ°å›¾');
            
            if (window.map) {
                // æ¸…ç†æ‰€æœ‰è¦†ç›–ç‰©
                const overlays = window.map.getAllOverlays();
                overlays.forEach(overlay => {
                    try {
                        window.map.remove(overlay);
                    } catch (error) {
                        console.warn('æ¸…ç†è¦†ç›–ç‰©æ—¶å‡ºé”™:', error);
                    }
                });
                
                // é‡ç½®å…¨å±€å˜é‡
                window.pickupMarker = null;
                window.destMarker = null;
                window.driverMarker = null;
                window.routeLine = null;
                window.driverRouteLine = null;
                
                console.log('âœ… åœ°å›¾å¼ºåˆ¶æ¸…ç†å®Œæˆ');
            } else {
                console.log('âŒ åœ°å›¾å¯¹è±¡ä¸å­˜åœ¨');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        window.onload = function() {
            console.log('ğŸš€ ä¹˜å®¢ç«¯åœ°å›¾ä¿®å¤æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            console.log('ğŸ’¡ è¯·åœ¨ä¹˜å®¢ç«¯é¡µé¢æ‰“å¼€æ­¤æµ‹è¯•é¡µé¢è¿›è¡Œè°ƒè¯•');
        };
    </script>
</body>
</html>