<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>司机订单查询功能测试</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e4e7ed;
            border-radius: 8px;
        }
        .test-title {
            font-size: 18px;
            font-weight: 600;
            color: #303133;
            margin-bottom: 16px;
        }
        .test-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .test-result {
            background: #f8f9fa;
            border-radius: 4px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #67c23a; }
        .error { color: #f56c6c; }
        .info { color: #409eff; }
        .warning { color: #e6a23c; }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <h1>司机订单查询功能测试</h1>
            
            <!-- 基础查询测试 -->
            <div class="test-section">
                <div class="test-title">1. 基础订单查询</div>
                <div class="test-controls">
                    <el-input v-model="driverId" placeholder="司机ID" style="width: 120px;"></el-input>
                    <el-button @click="testBasicQuery" type="primary">基础查询</el-button>
                </div>
                <div class="test-result">{{ basicQueryResult }}</div>
            </div>

            <!-- 状态筛选测试 -->
            <div class="test-section">
                <div class="test-title">2. 状态筛选查询</div>
                <div class="test-controls">
                    <el-select v-model="statusFilter" placeholder="选择状态" style="width: 150px;">
                        <el-option label="已完成" value="COMPLETED"></el-option>
                        <el-option label="已取消" value="CANCELLED"></el-option>
                        <el-option label="进行中" value="IN_PROGRESS"></el-option>
                        <el-option label="已接单" value="ASSIGNED"></el-option>
                    </el-select>
                    <el-button @click="testStatusFilter" type="primary">状态筛选</el-button>
                </div>
                <div class="test-result">{{ statusFilterResult }}</div>
            </div>

            <!-- 日期范围查询测试 -->
            <div class="test-section">
                <div class="test-title">3. 日期范围查询</div>
                <div class="test-controls">
                    <el-date-picker
                        v-model="dateRange"
                        type="daterange"
                        range-separator="至"
                        start-placeholder="开始日期"
                        end-placeholder="结束日期"
                        format="YYYY-MM-DD"
                        value-format="YYYY-MM-DD"
                        style="width: 300px;">
                    </el-date-picker>
                    <el-button @click="testDateRange" type="primary">日期查询</el-button>
                </div>
                <div class="test-result">{{ dateRangeResult }}</div>
            </div>

            <!-- 订单号搜索测试 -->
            <div class="test-section">
                <div class="test-title">4. 订单号搜索</div>
                <div class="test-controls">
                    <el-input v-model="orderNumber" placeholder="输入订单号关键词" style="width: 200px;"></el-input>
                    <el-button @click="testOrderNumberSearch" type="primary">订单号搜索</el-button>
                </div>
                <div class="test-result">{{ orderNumberResult }}</div>
            </div>

            <!-- 费用范围查询测试 -->
            <div class="test-section">
                <div class="test-title">5. 费用范围查询</div>
                <div class="test-controls">
                    <el-input-number v-model="minFare" :min="0" :precision="2" placeholder="最低费用" style="width: 120px;"></el-input-number>
                    <span>-</span>
                    <el-input-number v-model="maxFare" :min="0" :precision="2" placeholder="最高费用" style="width: 120px;"></el-input-number>
                    <el-button @click="testFareRange" type="primary">费用查询</el-button>
                </div>
                <div class="test-result">{{ fareRangeResult }}</div>
            </div>

            <!-- 地址搜索测试 -->
            <div class="test-section">
                <div class="test-title">6. 地址搜索</div>
                <div class="test-controls">
                    <el-input v-model="pickupAddress" placeholder="起点地址关键词" style="width: 150px;"></el-input>
                    <el-input v-model="destinationAddress" placeholder="终点地址关键词" style="width: 150px;"></el-input>
                    <el-button @click="testAddressSearch" type="primary">地址搜索</el-button>
                </div>
                <div class="test-result">{{ addressSearchResult }}</div>
            </div>

            <!-- 综合查询测试 -->
            <div class="test-section">
                <div class="test-title">7. 综合查询测试</div>
                <div class="test-controls">
                    <el-button @click="testComplexQuery" type="success">综合查询</el-button>
                    <el-button @click="testPagination" type="info">分页测试</el-button>
                </div>
                <div class="test-result">{{ complexQueryResult }}</div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <script>
        const { createApp, ref } = Vue;
        
        createApp({
            setup() {
                // 测试数据
                const driverId = ref('1');
                const statusFilter = ref('');
                const dateRange = ref(null);
                const orderNumber = ref('');
                const minFare = ref(null);
                const maxFare = ref(null);
                const pickupAddress = ref('');
                const destinationAddress = ref('');
                
                // 测试结果
                const basicQueryResult = ref('等待测试...');
                const statusFilterResult = ref('等待测试...');
                const dateRangeResult = ref('等待测试...');
                const orderNumberResult = ref('等待测试...');
                const fareRangeResult = ref('等待测试...');
                const addressSearchResult = ref('等待测试...');
                const complexQueryResult = ref('等待测试...');

                // 通用请求函数
                const makeRequest = async (params = {}) => {
                    try {
                        const url = new URL(`/api/drivers/${driverId.value}/orders`, window.location.origin);
                        Object.keys(params).forEach(key => {
                            if (params[key] !== null && params[key] !== undefined && params[key] !== '') {
                                url.searchParams.append(key, params[key]);
                            }
                        });

                        console.log('请求URL:', url.toString());
                        
                        const response = await fetch(url);
                        const result = await response.json();
                        
                        return {
                            success: result.code === 200,
                            data: result.data,
                            message: result.message,
                            url: url.toString()
                        };
                    } catch (error) {
                        return {
                            success: false,
                            error: error.message,
                            url: params.url || '请求失败'
                        };
                    }
                };

                // 格式化结果
                const formatResult = (result) => {
                    if (!result.success) {
                        return `❌ 请求失败: ${result.error || result.message}\n请求URL: ${result.url}`;
                    }
                    
                    const data = result.data;
                    let output = `✅ 请求成功\n请求URL: ${result.url}\n\n`;
                    
                    if (data.orders) {
                        output += `📊 查询结果统计:\n`;
                        output += `- 总记录数: ${data.total}\n`;
                        output += `- 当前页: ${data.page}\n`;
                        output += `- 页面大小: ${data.size}\n`;
                        output += `- 总页数: ${data.totalPages}\n`;
                        output += `- 当前页记录数: ${data.orders.length}\n\n`;
                        
                        if (data.orders.length > 0) {
                            output += `📋 订单列表:\n`;
                            data.orders.forEach((order, index) => {
                                output += `${index + 1}. 订单号: ${order.orderNumber}\n`;
                                output += `   状态: ${order.status}\n`;
                                output += `   类型: ${order.orderType || 'REAL_TIME'}\n`;
                                output += `   费用: ¥${order.actualFare || order.estimatedFare || '0'}\n`;
                                output += `   起点: ${order.pickupAddress}\n`;
                                output += `   终点: ${order.destinationAddress}\n`;
                                output += `   创建时间: ${order.createdAt}\n\n`;
                            });
                        }
                    } else if (Array.isArray(data)) {
                        output += `📋 查询到 ${data.length} 条记录\n\n`;
                        data.forEach((order, index) => {
                            output += `${index + 1}. ${order.orderNumber} - ${order.status}\n`;
                        });
                    }
                    
                    return output;
                };

                // 测试函数
                const testBasicQuery = async () => {
                    basicQueryResult.value = '🔄 正在查询...';
                    const result = await makeRequest({ page: 1, size: 10 });
                    basicQueryResult.value = formatResult(result);
                };

                const testStatusFilter = async () => {
                    statusFilterResult.value = '🔄 正在查询...';
                    const result = await makeRequest({ 
                        status: statusFilter.value,
                        page: 1, 
                        size: 10 
                    });
                    statusFilterResult.value = formatResult(result);
                };

                const testDateRange = async () => {
                    dateRangeResult.value = '🔄 正在查询...';
                    const params = { page: 1, size: 10 };
                    if (dateRange.value && dateRange.value.length === 2) {
                        params.startDate = dateRange.value[0];
                        params.endDate = dateRange.value[1];
                    }
                    const result = await makeRequest(params);
                    dateRangeResult.value = formatResult(result);
                };

                const testOrderNumberSearch = async () => {
                    orderNumberResult.value = '🔄 正在查询...';
                    const result = await makeRequest({ 
                        orderNumber: orderNumber.value,
                        page: 1, 
                        size: 10 
                    });
                    orderNumberResult.value = formatResult(result);
                };

                const testFareRange = async () => {
                    fareRangeResult.value = '🔄 正在查询...';
                    const params = { page: 1, size: 10 };
                    if (minFare.value !== null) params.minFare = minFare.value;
                    if (maxFare.value !== null) params.maxFare = maxFare.value;
                    const result = await makeRequest(params);
                    fareRangeResult.value = formatResult(result);
                };

                const testAddressSearch = async () => {
                    addressSearchResult.value = '🔄 正在查询...';
                    const params = { page: 1, size: 10 };
                    if (pickupAddress.value) params.pickupAddress = pickupAddress.value;
                    if (destinationAddress.value) params.destinationAddress = destinationAddress.value;
                    const result = await makeRequest(params);
                    addressSearchResult.value = formatResult(result);
                };

                const testComplexQuery = async () => {
                    complexQueryResult.value = '🔄 正在查询...';
                    const params = {
                        status: 'COMPLETED',
                        orderType: 'REAL_TIME',
                        minFare: 10,
                        maxFare: 100,
                        page: 1,
                        size: 5
                    };
                    const result = await makeRequest(params);
                    complexQueryResult.value = formatResult(result);
                };

                const testPagination = async () => {
                    complexQueryResult.value = '🔄 正在测试分页...';
                    let output = '📄 分页测试结果:\n\n';
                    
                    for (let page = 1; page <= 3; page++) {
                        const result = await makeRequest({ page, size: 5 });
                        output += `第 ${page} 页:\n`;
                        if (result.success && result.data.orders) {
                            output += `- 记录数: ${result.data.orders.length}\n`;
                            output += `- 总数: ${result.data.total}\n\n`;
                        } else {
                            output += `- 查询失败或无数据\n\n`;
                        }
                    }
                    
                    complexQueryResult.value = output;
                };

                return {
                    driverId,
                    statusFilter,
                    dateRange,
                    orderNumber,
                    minFare,
                    maxFare,
                    pickupAddress,
                    destinationAddress,
                    basicQueryResult,
                    statusFilterResult,
                    dateRangeResult,
                    orderNumberResult,
                    fareRangeResult,
                    addressSearchResult,
                    complexQueryResult,
                    testBasicQuery,
                    testStatusFilter,
                    testDateRange,
                    testOrderNumberSearch,
                    testFareRange,
                    testAddressSearch,
                    testComplexQuery,
                    testPagination
                };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>