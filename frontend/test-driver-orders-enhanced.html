<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸æœºè®¢å•æŸ¥è¯¢åŠŸèƒ½æµ‹è¯•</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e4e7ed;
            border-radius: 8px;
        }
        .test-title {
            font-size: 18px;
            font-weight: 600;
            color: #303133;
            margin-bottom: 16px;
        }
        .test-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .test-result {
            background: #f8f9fa;
            border-radius: 4px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #67c23a; }
        .error { color: #f56c6c; }
        .info { color: #409eff; }
        .warning { color: #e6a23c; }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <h1>å¸æœºè®¢å•æŸ¥è¯¢åŠŸèƒ½æµ‹è¯•</h1>
            
            <!-- åŸºç¡€æŸ¥è¯¢æµ‹è¯• -->
            <div class="test-section">
                <div class="test-title">1. åŸºç¡€è®¢å•æŸ¥è¯¢</div>
                <div class="test-controls">
                    <el-input v-model="driverId" placeholder="å¸æœºID" style="width: 120px;"></el-input>
                    <el-button @click="testBasicQuery" type="primary">åŸºç¡€æŸ¥è¯¢</el-button>
                </div>
                <div class="test-result">{{ basicQueryResult }}</div>
            </div>

            <!-- çŠ¶æ€ç­›é€‰æµ‹è¯• -->
            <div class="test-section">
                <div class="test-title">2. çŠ¶æ€ç­›é€‰æŸ¥è¯¢</div>
                <div class="test-controls">
                    <el-select v-model="statusFilter" placeholder="é€‰æ‹©çŠ¶æ€" style="width: 150px;">
                        <el-option label="å·²å®Œæˆ" value="COMPLETED"></el-option>
                        <el-option label="å·²å–æ¶ˆ" value="CANCELLED"></el-option>
                        <el-option label="è¿›è¡Œä¸­" value="IN_PROGRESS"></el-option>
                        <el-option label="å·²æ¥å•" value="ASSIGNED"></el-option>
                    </el-select>
                    <el-button @click="testStatusFilter" type="primary">çŠ¶æ€ç­›é€‰</el-button>
                </div>
                <div class="test-result">{{ statusFilterResult }}</div>
            </div>

            <!-- æ—¥æœŸèŒƒå›´æŸ¥è¯¢æµ‹è¯• -->
            <div class="test-section">
                <div class="test-title">3. æ—¥æœŸèŒƒå›´æŸ¥è¯¢</div>
                <div class="test-controls">
                    <el-date-picker
                        v-model="dateRange"
                        type="daterange"
                        range-separator="è‡³"
                        start-placeholder="å¼€å§‹æ—¥æœŸ"
                        end-placeholder="ç»“æŸæ—¥æœŸ"
                        format="YYYY-MM-DD"
                        value-format="YYYY-MM-DD"
                        style="width: 300px;">
                    </el-date-picker>
                    <el-button @click="testDateRange" type="primary">æ—¥æœŸæŸ¥è¯¢</el-button>
                </div>
                <div class="test-result">{{ dateRangeResult }}</div>
            </div>

            <!-- è®¢å•å·æœç´¢æµ‹è¯• -->
            <div class="test-section">
                <div class="test-title">4. è®¢å•å·æœç´¢</div>
                <div class="test-controls">
                    <el-input v-model="orderNumber" placeholder="è¾“å…¥è®¢å•å·å…³é”®è¯" style="width: 200px;"></el-input>
                    <el-button @click="testOrderNumberSearch" type="primary">è®¢å•å·æœç´¢</el-button>
                </div>
                <div class="test-result">{{ orderNumberResult }}</div>
            </div>

            <!-- è´¹ç”¨èŒƒå›´æŸ¥è¯¢æµ‹è¯• -->
            <div class="test-section">
                <div class="test-title">5. è´¹ç”¨èŒƒå›´æŸ¥è¯¢</div>
                <div class="test-controls">
                    <el-input-number v-model="minFare" :min="0" :precision="2" placeholder="æœ€ä½è´¹ç”¨" style="width: 120px;"></el-input-number>
                    <span>-</span>
                    <el-input-number v-model="maxFare" :min="0" :precision="2" placeholder="æœ€é«˜è´¹ç”¨" style="width: 120px;"></el-input-number>
                    <el-button @click="testFareRange" type="primary">è´¹ç”¨æŸ¥è¯¢</el-button>
                </div>
                <div class="test-result">{{ fareRangeResult }}</div>
            </div>

            <!-- åœ°å€æœç´¢æµ‹è¯• -->
            <div class="test-section">
                <div class="test-title">6. åœ°å€æœç´¢</div>
                <div class="test-controls">
                    <el-input v-model="pickupAddress" placeholder="èµ·ç‚¹åœ°å€å…³é”®è¯" style="width: 150px;"></el-input>
                    <el-input v-model="destinationAddress" placeholder="ç»ˆç‚¹åœ°å€å…³é”®è¯" style="width: 150px;"></el-input>
                    <el-button @click="testAddressSearch" type="primary">åœ°å€æœç´¢</el-button>
                </div>
                <div class="test-result">{{ addressSearchResult }}</div>
            </div>

            <!-- ç»¼åˆæŸ¥è¯¢æµ‹è¯• -->
            <div class="test-section">
                <div class="test-title">7. ç»¼åˆæŸ¥è¯¢æµ‹è¯•</div>
                <div class="test-controls">
                    <el-button @click="testComplexQuery" type="success">ç»¼åˆæŸ¥è¯¢</el-button>
                    <el-button @click="testPagination" type="info">åˆ†é¡µæµ‹è¯•</el-button>
                </div>
                <div class="test-result">{{ complexQueryResult }}</div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <script>
        const { createApp, ref } = Vue;
        
        createApp({
            setup() {
                // æµ‹è¯•æ•°æ®
                const driverId = ref('1');
                const statusFilter = ref('');
                const dateRange = ref(null);
                const orderNumber = ref('');
                const minFare = ref(null);
                const maxFare = ref(null);
                const pickupAddress = ref('');
                const destinationAddress = ref('');
                
                // æµ‹è¯•ç»“æœ
                const basicQueryResult = ref('ç­‰å¾…æµ‹è¯•...');
                const statusFilterResult = ref('ç­‰å¾…æµ‹è¯•...');
                const dateRangeResult = ref('ç­‰å¾…æµ‹è¯•...');
                const orderNumberResult = ref('ç­‰å¾…æµ‹è¯•...');
                const fareRangeResult = ref('ç­‰å¾…æµ‹è¯•...');
                const addressSearchResult = ref('ç­‰å¾…æµ‹è¯•...');
                const complexQueryResult = ref('ç­‰å¾…æµ‹è¯•...');

                // é€šç”¨è¯·æ±‚å‡½æ•°
                const makeRequest = async (params = {}) => {
                    try {
                        const url = new URL(`/api/drivers/${driverId.value}/orders`, window.location.origin);
                        Object.keys(params).forEach(key => {
                            if (params[key] !== null && params[key] !== undefined && params[key] !== '') {
                                url.searchParams.append(key, params[key]);
                            }
                        });

                        console.log('è¯·æ±‚URL:', url.toString());
                        
                        const response = await fetch(url);
                        const result = await response.json();
                        
                        return {
                            success: result.code === 200,
                            data: result.data,
                            message: result.message,
                            url: url.toString()
                        };
                    } catch (error) {
                        return {
                            success: false,
                            error: error.message,
                            url: params.url || 'è¯·æ±‚å¤±è´¥'
                        };
                    }
                };

                // æ ¼å¼åŒ–ç»“æœ
                const formatResult = (result) => {
                    if (!result.success) {
                        return `âŒ è¯·æ±‚å¤±è´¥: ${result.error || result.message}\nè¯·æ±‚URL: ${result.url}`;
                    }
                    
                    const data = result.data;
                    let output = `âœ… è¯·æ±‚æˆåŠŸ\nè¯·æ±‚URL: ${result.url}\n\n`;
                    
                    if (data.orders) {
                        output += `ğŸ“Š æŸ¥è¯¢ç»“æœç»Ÿè®¡:\n`;
                        output += `- æ€»è®°å½•æ•°: ${data.total}\n`;
                        output += `- å½“å‰é¡µ: ${data.page}\n`;
                        output += `- é¡µé¢å¤§å°: ${data.size}\n`;
                        output += `- æ€»é¡µæ•°: ${data.totalPages}\n`;
                        output += `- å½“å‰é¡µè®°å½•æ•°: ${data.orders.length}\n\n`;
                        
                        if (data.orders.length > 0) {
                            output += `ğŸ“‹ è®¢å•åˆ—è¡¨:\n`;
                            data.orders.forEach((order, index) => {
                                output += `${index + 1}. è®¢å•å·: ${order.orderNumber}\n`;
                                output += `   çŠ¶æ€: ${order.status}\n`;
                                output += `   ç±»å‹: ${order.orderType || 'REAL_TIME'}\n`;
                                output += `   è´¹ç”¨: Â¥${order.actualFare || order.estimatedFare || '0'}\n`;
                                output += `   èµ·ç‚¹: ${order.pickupAddress}\n`;
                                output += `   ç»ˆç‚¹: ${order.destinationAddress}\n`;
                                output += `   åˆ›å»ºæ—¶é—´: ${order.createdAt}\n\n`;
                            });
                        }
                    } else if (Array.isArray(data)) {
                        output += `ğŸ“‹ æŸ¥è¯¢åˆ° ${data.length} æ¡è®°å½•\n\n`;
                        data.forEach((order, index) => {
                            output += `${index + 1}. ${order.orderNumber} - ${order.status}\n`;
                        });
                    }
                    
                    return output;
                };

                // æµ‹è¯•å‡½æ•°
                const testBasicQuery = async () => {
                    basicQueryResult.value = 'ğŸ”„ æ­£åœ¨æŸ¥è¯¢...';
                    const result = await makeRequest({ page: 1, size: 10 });
                    basicQueryResult.value = formatResult(result);
                };

                const testStatusFilter = async () => {
                    statusFilterResult.value = 'ğŸ”„ æ­£åœ¨æŸ¥è¯¢...';
                    const result = await makeRequest({ 
                        status: statusFilter.value,
                        page: 1, 
                        size: 10 
                    });
                    statusFilterResult.value = formatResult(result);
                };

                const testDateRange = async () => {
                    dateRangeResult.value = 'ğŸ”„ æ­£åœ¨æŸ¥è¯¢...';
                    const params = { page: 1, size: 10 };
                    if (dateRange.value && dateRange.value.length === 2) {
                        params.startDate = dateRange.value[0];
                        params.endDate = dateRange.value[1];
                    }
                    const result = await makeRequest(params);
                    dateRangeResult.value = formatResult(result);
                };

                const testOrderNumberSearch = async () => {
                    orderNumberResult.value = 'ğŸ”„ æ­£åœ¨æŸ¥è¯¢...';
                    const result = await makeRequest({ 
                        orderNumber: orderNumber.value,
                        page: 1, 
                        size: 10 
                    });
                    orderNumberResult.value = formatResult(result);
                };

                const testFareRange = async () => {
                    fareRangeResult.value = 'ğŸ”„ æ­£åœ¨æŸ¥è¯¢...';
                    const params = { page: 1, size: 10 };
                    if (minFare.value !== null) params.minFare = minFare.value;
                    if (maxFare.value !== null) params.maxFare = maxFare.value;
                    const result = await makeRequest(params);
                    fareRangeResult.value = formatResult(result);
                };

                const testAddressSearch = async () => {
                    addressSearchResult.value = 'ğŸ”„ æ­£åœ¨æŸ¥è¯¢...';
                    const params = { page: 1, size: 10 };
                    if (pickupAddress.value) params.pickupAddress = pickupAddress.value;
                    if (destinationAddress.value) params.destinationAddress = destinationAddress.value;
                    const result = await makeRequest(params);
                    addressSearchResult.value = formatResult(result);
                };

                const testComplexQuery = async () => {
                    complexQueryResult.value = 'ğŸ”„ æ­£åœ¨æŸ¥è¯¢...';
                    const params = {
                        status: 'COMPLETED',
                        orderType: 'REAL_TIME',
                        minFare: 10,
                        maxFare: 100,
                        page: 1,
                        size: 5
                    };
                    const result = await makeRequest(params);
                    complexQueryResult.value = formatResult(result);
                };

                const testPagination = async () => {
                    complexQueryResult.value = 'ğŸ”„ æ­£åœ¨æµ‹è¯•åˆ†é¡µ...';
                    let output = 'ğŸ“„ åˆ†é¡µæµ‹è¯•ç»“æœ:\n\n';
                    
                    for (let page = 1; page <= 3; page++) {
                        const result = await makeRequest({ page, size: 5 });
                        output += `ç¬¬ ${page} é¡µ:\n`;
                        if (result.success && result.data.orders) {
                            output += `- è®°å½•æ•°: ${result.data.orders.length}\n`;
                            output += `- æ€»æ•°: ${result.data.total}\n\n`;
                        } else {
                            output += `- æŸ¥è¯¢å¤±è´¥æˆ–æ— æ•°æ®\n\n`;
                        }
                    }
                    
                    complexQueryResult.value = output;
                };

                return {
                    driverId,
                    statusFilter,
                    dateRange,
                    orderNumber,
                    minFare,
                    maxFare,
                    pickupAddress,
                    destinationAddress,
                    basicQueryResult,
                    statusFilterResult,
                    dateRangeResult,
                    orderNumberResult,
                    fareRangeResult,
                    addressSearchResult,
                    complexQueryResult,
                    testBasicQuery,
                    testStatusFilter,
                    testDateRange,
                    testOrderNumberSearch,
                    testFareRange,
                    testAddressSearch,
                    testComplexQuery,
                    testPagination
                };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>