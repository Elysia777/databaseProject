<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset=\"UTF-8\">
    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">
    <title>è®¢å•è·ç¦»è´¹ç”¨ä¿¡æ¯ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        .warning { background-color: #fff3cd; color: #856404; }
        .problem-analysis {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }
        .fix-highlight {
            background: #d4edda;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #28a745;
            margin: 15px 0;
        }
        .code-block {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
            border: 1px solid #e9ecef;
            overflow-x: auto;
            margin: 10px 0;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .before, .after {
            padding: 15px;
            border-radius: 5px;
        }
        .before { 
            background: #fff3cd; 
            border-left: 4px solid #ffc107;
        }
        .after { 
            background: #d4edda; 
            border-left: 4px solid #28a745;
        }
        .data-flow {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #e9ecef;
            margin: 15px 0;
        }
        .flow-step {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 3px;
            border-left: 3px solid #007bff;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 3px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background-color: #0056b3; }
        .field-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .field-table th, .field-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .field-table th {
            background-color: #f8f9fa;
        }
        .status-missing { color: #dc3545; font-weight: bold; }
        .status-fixed { color: #28a745; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ğŸ”§ è®¢å•è·ç¦»è´¹ç”¨ä¿¡æ¯ä¿®å¤æµ‹è¯•</h1>

    <div class=\"test-section\">
        <h3>ğŸ› é—®é¢˜å‘ç°</h3>
        <div class=\"problem-analysis\">
            <strong>é—®é¢˜æè¿°ï¼š</strong><br>
            ä¹˜å®¢å‘èµ·è®¢å•æ—¶å¯ä»¥çœ‹åˆ°è·ç¦»å’Œè´¹ç”¨ï¼Œä½†é€šçŸ¥å¸æœºæ—¶æ²¡æœ‰æ˜¾ç¤ºï¼Œæ•°æ®åº“ä¹Ÿæ²¡æœ‰è®°å½•ç›¸å…³ä¿¡æ¯ã€‚
            <br><br>
            <strong>å½±å“ï¼š</strong><br>
            â€¢ å¸æœºæ”¶åˆ°çš„è®¢å•é€šçŸ¥ç¼ºå°‘è·ç¦»å’Œè´¹ç”¨ä¿¡æ¯<br>
            â€¢ æ•°æ®åº“ä¸­è®¢å•è®°å½•ä¸å®Œæ•´<br>
            â€¢ å½±å“å¸æœºæ¥å•å†³ç­–<br>
            â€¢ åç»­è´¹ç”¨è®¡ç®—å¯èƒ½ä¸å‡†ç¡®
        </div>
    </div>

    <div class=\"test-section\">
        <h3>ğŸ“Š æ•°æ®æµåˆ†æ</h3>
        
        <div class=\"data-flow\">
            <h4>è®¢å•æ•°æ®æµè½¬è¿‡ç¨‹</h4>
            
            <div class=\"flow-step\">
                <strong>æ­¥éª¤1ï¼š</strong> ä¹˜å®¢ç«¯è®¡ç®—è·¯çº¿ä¿¡æ¯
                <div class=\"code-block\">
routeInfo.value = {
    distance: 8500,  // 8.5å…¬é‡Œï¼ˆç±³ï¼‰
    duration: 1200   // 20åˆ†é’Ÿï¼ˆç§’ï¼‰
}
                </div>
            </div>
            
            <div class=\"flow-step\">
                <strong>æ­¥éª¤2ï¼š</strong> ä¹˜å®¢ç«¯åˆ›å»ºè®¢å•æ•°æ®
                <div class=\"code-block\">
const orderData = {
    // âŒ ä¿®å¤å‰ï¼šç¼ºå°‘è·ç¦»å’Œæ—¶é•¿ä¿¡æ¯
    estimatedFare: getPrice(selectedCarType.value)
    
    // âœ… ä¿®å¤åï¼šåŒ…å«å®Œæ•´ä¿¡æ¯
    estimatedDistance: (routeInfo.value.distance / 1000).toFixed(2), // 8.50
    estimatedDuration: Math.round(routeInfo.value.duration / 60),     // 20
    estimatedFare: getPrice(selectedCarType.value)                    // 25.00
}
                </div>
            </div>
            
            <div class=\"flow-step\">
                <strong>æ­¥éª¤3ï¼š</strong> åç«¯ä¿å­˜è®¢å•ä¿¡æ¯
                <div class=\"code-block\">
// âœ… ä¿®å¤åï¼šä¿å­˜å®Œæ•´çš„è®¢å•ä¿¡æ¯
order.setEstimatedDistance(request.getEstimatedDistance());
order.setEstimatedDuration(request.getEstimatedDuration());
order.setEstimatedFare(request.getEstimatedFare());
                </div>
            </div>
            
            <div class=\"flow-step\">
                <strong>æ­¥éª¤4ï¼š</strong> WebSocketé€šçŸ¥å¸æœº
                <div class=\"code-block\">
// âœ… é€šçŸ¥ä¸­åŒ…å«å®Œæ•´ä¿¡æ¯
notification.put(\"distance\", order.getEstimatedDistance());
notification.put(\"duration\", order.getEstimatedDuration());
notification.put(\"estimatedFare\", order.getEstimatedFare());
                </div>
            </div>
        </div>
    </div>

    <div class=\"test-section\">
        <h3>ğŸ” ä¿®å¤å†…å®¹å¯¹æ¯”</h3>
        
        <div class=\"comparison\">
            <div class=\"before\">
                <h4>âŒ ä¿®å¤å‰çš„æ•°æ®ç»“æ„</h4>
                
                <h5>å‰ç«¯è®¢å•æ•°æ®ï¼š</h5>
                <div class=\"code-block\">
const orderData = {
    passengerId: 1,
    pickupAddress: \"èµ·ç‚¹åœ°å€\",
    destinationAddress: \"ç»ˆç‚¹åœ°å€\",
    // âŒ ç¼ºå°‘è·ç¦»ä¿¡æ¯
    // âŒ ç¼ºå°‘æ—¶é•¿ä¿¡æ¯
    estimatedFare: 25.00
};
                </div>
                
                <h5>åç«¯DTOç±»ï¼š</h5>
                <div class=\"code-block\">
public class CreateOrderRequest {
    private String pickupAddress;
    private String destinationAddress;
    // âŒ ç¼ºå°‘ estimatedDistance
    // âŒ ç¼ºå°‘ estimatedDuration
    // âŒ ç¼ºå°‘ estimatedFare
}
                </div>
            </div>
            
            <div class=\"after\">
                <h4>âœ… ä¿®å¤åçš„æ•°æ®ç»“æ„</h4>
                
                <h5>å‰ç«¯è®¢å•æ•°æ®ï¼š</h5>
                <div class=\"code-block\">
const orderData = {
    passengerId: 1,
    pickupAddress: \"èµ·ç‚¹åœ°å€\",
    destinationAddress: \"ç»ˆç‚¹åœ°å€\",
    // âœ… æ·»åŠ è·ç¦»ä¿¡æ¯ï¼ˆå…¬é‡Œï¼‰
    estimatedDistance: 8.50,
    // âœ… æ·»åŠ æ—¶é•¿ä¿¡æ¯ï¼ˆåˆ†é’Ÿï¼‰
    estimatedDuration: 20,
    estimatedFare: 25.00
};
                </div>
                
                <h5>åç«¯DTOç±»ï¼š</h5>
                <div class=\"code-block\">
public class CreateOrderRequest {
    private String pickupAddress;
    private String destinationAddress;
    // âœ… æ·»åŠ è·ç¦»å­—æ®µ
    private BigDecimal estimatedDistance;
    // âœ… æ·»åŠ æ—¶é•¿å­—æ®µ
    private Integer estimatedDuration;
    // âœ… æ·»åŠ è´¹ç”¨å­—æ®µ
    private BigDecimal estimatedFare;
}
                </div>
            </div>
        </div>
    </div>

    <div class=\"test-section\">
        <h3>ğŸ› ï¸ å…·ä½“ä¿®å¤å†…å®¹</h3>
        
        <div class=\"fix-highlight\">
            <strong>1. å‰ç«¯æ•°æ®å®Œå–„ï¼ˆPassengerMap.vueï¼‰</strong><br>
            â€¢ åœ¨åˆ›å»ºè®¢å•æ—¶æ·»åŠ  estimatedDistance å­—æ®µ<br>
            â€¢ åœ¨åˆ›å»ºè®¢å•æ—¶æ·»åŠ  estimatedDuration å­—æ®µ<br>
            â€¢ åˆ©ç”¨ç°æœ‰çš„ routeInfo æ•°æ®è¿›è¡Œè®¡ç®—
        </div>
        
        <div class=\"fix-highlight\">
            <strong>2. åç«¯DTOç±»æ‰©å±•</strong><br>
            â€¢ CreateOrderRequest æ·»åŠ è·ç¦»ã€æ—¶é•¿ã€è´¹ç”¨å­—æ®µ<br>
            â€¢ CreateScheduledOrderRequest æ·»åŠ ç›¸åŒå­—æ®µ<br>
            â€¢ æ·»åŠ å¯¹åº”çš„ getter/setter æ–¹æ³•
        </div>
        
        <div class=\"fix-highlight\">
            <strong>3. åç«¯æ§åˆ¶å™¨ä¿®å¤</strong><br>
            â€¢ OrderController ä¿å­˜è·ç¦»å’Œæ—¶é•¿ä¿¡æ¯<br>
            â€¢ ScheduledOrderController ä¿å­˜è·ç¦»å’Œæ—¶é•¿ä¿¡æ¯<br>
            â€¢ ç¡®ä¿æ•°æ®åº“è®°å½•å®Œæ•´
        </div>
        
        <div class=\"fix-highlight\">
            <strong>4. WebSocketé€šçŸ¥å¢å¼º</strong><br>
            â€¢ é€šçŸ¥ä¸­åŒ…å«å‡†ç¡®çš„è·ç¦»ä¿¡æ¯<br>
            â€¢ é€šçŸ¥ä¸­åŒ…å«é¢„ä¼°æ—¶é•¿ä¿¡æ¯<br>
            â€¢ å¸æœºèƒ½çœ‹åˆ°å®Œæ•´çš„è®¢å•ä¿¡æ¯
        </div>
    </div>

    <div class=\"test-section\">
        <h3>ğŸ“‹ å­—æ®µå¯¹æ¯”è¡¨</h3>
        
        <table class=\"field-table\">
            <thead>
                <tr>
                    <th>å­—æ®µå</th>
                    <th>ç±»å‹</th>
                    <th>ä¿®å¤å‰çŠ¶æ€</th>
                    <th>ä¿®å¤åçŠ¶æ€</th>
                    <th>è¯´æ˜</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>estimatedDistance</td>
                    <td>BigDecimal</td>
                    <td class=\"status-missing\">âŒ ç¼ºå¤±</td>
                    <td class=\"status-fixed\">âœ… å·²æ·»åŠ </td>
                    <td>é¢„ä¼°è·ç¦»ï¼ˆå…¬é‡Œï¼‰</td>
                </tr>
                <tr>
                    <td>estimatedDuration</td>
                    <td>Integer</td>
                    <td class=\"status-missing\">âŒ ç¼ºå¤±</td>
                    <td class=\"status-fixed\">âœ… å·²æ·»åŠ </td>
                    <td>é¢„ä¼°æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰</td>
                </tr>
                <tr>
                    <td>estimatedFare</td>
                    <td>BigDecimal</td>
                    <td class=\"status-missing\">âŒ éƒ¨åˆ†ç¼ºå¤±</td>
                    <td class=\"status-fixed\">âœ… å·²å®Œå–„</td>
                    <td>é¢„ä¼°è´¹ç”¨ï¼ˆå…ƒï¼‰</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class=\"test-section\">
        <h3>ğŸ§ª æµ‹è¯•éªŒè¯æ­¥éª¤</h3>
        
        <div class=\"result info\">
            <strong>æµ‹è¯•åœºæ™¯1ï¼šå®æ—¶è®¢å•</strong><br>
            1. ä¹˜å®¢åˆ›å»ºå®æ—¶è®¢å•<br>
            2. æ£€æŸ¥æ•°æ®åº“è®¢å•è®°å½•æ˜¯å¦åŒ…å«è·ç¦»ã€æ—¶é•¿ã€è´¹ç”¨<br>
            3. æ£€æŸ¥å¸æœºæ”¶åˆ°çš„é€šçŸ¥æ˜¯å¦æ˜¾ç¤ºå®Œæ•´ä¿¡æ¯<br>
            4. éªŒè¯ä¿¡æ¯çš„å‡†ç¡®æ€§
        </div>
        
        <div class=\"result info\">
            <strong>æµ‹è¯•åœºæ™¯2ï¼šé¢„çº¦è®¢å•</strong><br>
            1. ä¹˜å®¢åˆ›å»ºé¢„çº¦è®¢å•<br>
            2. æ£€æŸ¥æ•°æ®åº“è®¢å•è®°å½•æ˜¯å¦åŒ…å«è·ç¦»ã€æ—¶é•¿ã€è´¹ç”¨<br>
            3. é¢„çº¦å•æ¿€æ´»åæ£€æŸ¥å¸æœºé€šçŸ¥<br>
            4. éªŒè¯é¢„çº¦å•ä¿¡æ¯å®Œæ•´æ€§
        </div>
        
        <div class=\"result info\">
            <strong>æµ‹è¯•åœºæ™¯3ï¼šå¸æœºç«¯æ˜¾ç¤º</strong><br>
            1. å¸æœºæ¥æ”¶è®¢å•é€šçŸ¥<br>
            2. æ£€æŸ¥é€šçŸ¥ä¸­æ˜¯å¦æ˜¾ç¤ºè·ç¦»ä¿¡æ¯<br>
            3. æ£€æŸ¥é€šçŸ¥ä¸­æ˜¯å¦æ˜¾ç¤ºé¢„ä¼°è´¹ç”¨<br>
            4. éªŒè¯ä¿¡æ¯æœ‰åŠ©äºå¸æœºå†³ç­–
        </div>
    </div>

    <div class=\"test-section\">
        <h3>ğŸ” éªŒè¯æ£€æŸ¥ç‚¹</h3>
        
        <div class=\"result warning\">
            <strong>æ•°æ®åº“æ£€æŸ¥ï¼š</strong><br>
            â€¢ æŸ¥è¯¢ orders è¡¨çš„ estimated_distance å­—æ®µ<br>
            â€¢ æŸ¥è¯¢ orders è¡¨çš„ estimated_duration å­—æ®µ<br>
            â€¢ æŸ¥è¯¢ orders è¡¨çš„ estimated_fare å­—æ®µ<br>
            â€¢ ç¡®è®¤å­—æ®µå€¼ä¸ä¸º NULL ä¸”åˆç†
        </div>
        
        <div class=\"result warning\">
            <strong>å‰ç«¯æ£€æŸ¥ï¼š</strong><br>
            â€¢ ä¹˜å®¢ç«¯åˆ›å»ºè®¢å•æ—¶çš„è¯·æ±‚æ•°æ®<br>
            â€¢ å¸æœºç«¯æ”¶åˆ°çš„ WebSocket é€šçŸ¥å†…å®¹<br>
            â€¢ è®¢å•è¯¦æƒ…é¡µé¢çš„ä¿¡æ¯æ˜¾ç¤º
        </div>
        
        <div class=\"result warning\">
            <strong>åç«¯æ—¥å¿—æ£€æŸ¥ï¼š</strong><br>
            â€¢ è®¢å•åˆ›å»ºæ—¶çš„å­—æ®µè®¾ç½®æ—¥å¿—<br>
            â€¢ WebSocket é€šçŸ¥å‘é€çš„æ•°æ®å†…å®¹<br>
            â€¢ ç¡®è®¤æ²¡æœ‰ç©ºå€¼æˆ–å¼‚å¸¸
        </div>
    </div>

    <div class=\"test-section\">
        <h3>ğŸš€ å¼€å§‹æµ‹è¯•</h3>
        <p>ä½¿ç”¨ä»¥ä¸‹é“¾æ¥è¿›è¡Œè®¢å•è·ç¦»è´¹ç”¨ä¿¡æ¯æµ‹è¯•ï¼š</p>
        
        <div style=\"margin: 20px 0;\">
            <a href=\"/passenger-app.html\" target=\"_blank\">
                <button>ä¹˜å®¢ç«¯ï¼ˆåˆ›å»ºè®¢å•ï¼‰</button>
            </a>
            <a href=\"/driver-app.html\" target=\"_blank\">
                <button>å¸æœºç«¯ï¼ˆæ¥æ”¶é€šçŸ¥ï¼‰</button>
            </a>
        </div>

        <div class=\"result info\">
            <strong>æµ‹è¯•é‡ç‚¹ï¼š</strong><br>
            1. åˆ›å»ºè®¢å•åæ£€æŸ¥æ•°æ®åº“è®°å½•<br>
            2. å¸æœºæ”¶åˆ°é€šçŸ¥æ—¶æ£€æŸ¥æ˜¾ç¤ºå†…å®¹<br>
            3. å¯¹æ¯”ä¿®å¤å‰åçš„ä¿¡æ¯å®Œæ•´æ€§<br>
            4. éªŒè¯è·ç¦»å’Œè´¹ç”¨çš„å‡†ç¡®æ€§
        </div>
    </div>

    <div class=\"test-section\">
        <h3>âœ… é¢„æœŸä¿®å¤æ•ˆæœ</h3>
        <div class=\"result success\">
            <strong>ä¿®å¤å®Œæˆååº”è¯¥å®ç°ï¼š</strong><br>
            â€¢ è®¢å•åˆ›å»ºæ—¶ä¿å­˜å®Œæ•´çš„è·ç¦»ã€æ—¶é•¿ã€è´¹ç”¨ä¿¡æ¯ âœ…<br>
            â€¢ å¸æœºæ”¶åˆ°çš„é€šçŸ¥åŒ…å«è¯¦ç»†çš„è®¢å•ä¿¡æ¯ âœ…<br>
            â€¢ æ•°æ®åº“è®°å½•å®Œæ•´ï¼Œä¾¿äºåç»­åˆ†æå’Œè®¡è´¹ âœ…<br>
            â€¢ å¸æœºèƒ½åŸºäºå®Œæ•´ä¿¡æ¯åšå‡ºæ¥å•å†³ç­– âœ…<br>
            â€¢ å®æ—¶å•å’Œé¢„çº¦å•éƒ½æœ‰å®Œæ•´çš„ä¿¡æ¯è®°å½• âœ…
        </div>
    </div>
</body>
</html>