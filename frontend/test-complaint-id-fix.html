<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ•è¯‰åŠŸèƒ½IDä¿®å¤éªŒè¯</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e4e7ed;
            border-radius: 8px;
        }
        .test-title {
            font-size: 18px;
            font-weight: 600;
            color: #303133;
            margin-bottom: 16px;
        }
        .test-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .test-result {
            background: #f8f9fa;
            border-radius: 4px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #67c23a; }
        .error { color: #f56c6c; }
        .info { color: #409eff; }
        .warning { color: #e6a23c; }
        .fix-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid #67c23a;
        }
        .fix-icon {
            margin-right: 12px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <h1>æŠ•è¯‰åŠŸèƒ½IDä¿®å¤éªŒè¯</h1>
            
            <div class="test-section">
                <div class="test-title">ğŸ› ä¿®å¤çš„é—®é¢˜</div>
                
                <div class="fix-item">
                    <span class="fix-icon success">âœ…</span>
                    <div>
                        <strong>ç”¨æˆ·IDä¸ä¹˜å®¢IDæ··æ·†é—®é¢˜</strong><br>
                        ä¿®å¤äº†å‰ç«¯ä¼ é€’ç”¨æˆ·IDä½†åç«¯æœŸæœ›ä¹˜å®¢IDçš„é—®é¢˜
                    </div>
                </div>
                
                <div class="fix-item">
                    <span class="fix-icon success">âœ…</span>
                    <div>
                        <strong>è®¢å•æŸ¥è¯¢APIä¼˜åŒ–</strong><br>
                        ä¿®æ”¹äº†è·å–ä¹˜å®¢å†å²è®¢å•çš„APIï¼Œæ”¯æŒé€šè¿‡ç”¨æˆ·IDæŸ¥è¯¢
                    </div>
                </div>
                
                <div class="fix-item">
                    <span class="fix-icon success">âœ…</span>
                    <div>
                        <strong>æŠ•è¯‰åˆ›å»ºé€»è¾‘ä¼˜åŒ–</strong><br>
                        ä¿®å¤äº†åˆ›å»ºæŠ•è¯‰æ—¶å¸æœºç”¨æˆ·IDçš„æ­£ç¡®è·å–
                    </div>
                </div>
            </div>

            <!-- APIæµ‹è¯• -->
            <div class="test-section">
                <div class="test-title">1. ä¹˜å®¢å†å²è®¢å•APIæµ‹è¯•</div>
                <div class="test-controls">
                    <el-input v-model="userId" placeholder="ç”¨æˆ·ID" style="width: 120px;"></el-input>
                    <el-button @click="testPassengerOrders" type="primary">æµ‹è¯•è·å–è®¢å•</el-button>
                </div>
                <div class="test-result">{{ orderTestResult }}</div>
            </div>

            <!-- æŠ•è¯‰APIæµ‹è¯• -->
            <div class="test-section">
                <div class="test-title">2. æŠ•è¯‰åŠŸèƒ½APIæµ‹è¯•</div>
                <div class="test-controls">
                    <el-button @click="testUserComplaints" type="success">è·å–ç”¨æˆ·æŠ•è¯‰</el-button>
                    <el-button @click="testCreateComplaint" type="warning">æµ‹è¯•åˆ›å»ºæŠ•è¯‰</el-button>
                </div>
                <div class="test-result">{{ complaintTestResult }}</div>
            </div>

            <!-- æ•°æ®åº“å…³ç³»éªŒè¯ -->
            <div class="test-section">
                <div class="test-title">3. æ•°æ®åº“å…³ç³»éªŒè¯</div>
                <p>éªŒè¯ç”¨æˆ·IDã€ä¹˜å®¢IDã€å¸æœºIDä¹‹é—´çš„å…³ç³»ï¼š</p>
                <div class="test-controls">
                    <el-button @click="testDatabaseRelations" type="info">éªŒè¯æ•°æ®å…³ç³»</el-button>
                </div>
                <div class="test-result">{{ dbTestResult }}</div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <script>
        const { createApp, ref } = Vue;
        
        createApp({
            setup() {
                // æµ‹è¯•æ•°æ®
                const userId = ref('3');
                
                // æµ‹è¯•ç»“æœ
                const orderTestResult = ref('ç­‰å¾…æµ‹è¯•...');
                const complaintTestResult = ref('ç­‰å¾…æµ‹è¯•...');
                const dbTestResult = ref('ç­‰å¾…æµ‹è¯•...');

                // é€šç”¨è¯·æ±‚å‡½æ•°
                const makeRequest = async (url, options = {}) => {
                    try {
                        console.log('è¯·æ±‚URL:', url);
                        const response = await fetch(url, {
                            headers: {
                                'Content-Type': 'application/json',
                                ...options.headers
                            },
                            ...options
                        });
                        const result = await response.json();
                        return {
                            success: response.ok && result.code === 200,
                            data: result.data,
                            message: result.message,
                            status: response.status
                        };
                    } catch (error) {
                        return {
                            success: false,
                            error: error.message
                        };
                    }
                };

                // æµ‹è¯•ä¹˜å®¢è®¢å•æŸ¥è¯¢
                const testPassengerOrders = async () => {
                    orderTestResult.value = 'ğŸ”„ æ­£åœ¨æµ‹è¯•ä¹˜å®¢è®¢å•æŸ¥è¯¢...';
                    
                    const result = await makeRequest(`/api/orders/passenger/${userId.value}/history`);

                    if (result.success) {
                        const orders = result.data || [];
                        orderTestResult.value = `âœ… ä¹˜å®¢è®¢å•æŸ¥è¯¢æˆåŠŸ\nç”¨æˆ·ID: ${userId.value}\nè®¢å•æ•°é‡: ${orders.length}\n`;
                        
                        if (orders.length > 0) {
                            orderTestResult.value += `\nğŸ“‹ è®¢å•åˆ—è¡¨:\n`;
                            orders.slice(0, 3).forEach((order, index) => {
                                orderTestResult.value += `${index + 1}. è®¢å•å·: ${order.orderNumber}\n`;
                                orderTestResult.value += `   çŠ¶æ€: ${order.status}\n`;
                                orderTestResult.value += `   ä¹˜å®¢ID: ${order.passengerId}\n`;
                                orderTestResult.value += `   å¸æœºID: ${order.driverId || 'æœªåˆ†é…'}\n\n`;
                            });
                        } else {
                            orderTestResult.value += '\nğŸ“ æç¤º: è¯¥ç”¨æˆ·æš‚æ— è®¢å•è®°å½•ï¼Œè¿™å¯èƒ½æ˜¯æ­£å¸¸çš„';
                        }
                    } else {
                        orderTestResult.value = `âŒ ä¹˜å®¢è®¢å•æŸ¥è¯¢å¤±è´¥: ${result.error || result.message}\nçŠ¶æ€ç : ${result.status}`;
                    }
                };

                // æµ‹è¯•ç”¨æˆ·æŠ•è¯‰æŸ¥è¯¢
                const testUserComplaints = async () => {
                    complaintTestResult.value = 'ğŸ”„ æ­£åœ¨æµ‹è¯•ç”¨æˆ·æŠ•è¯‰æŸ¥è¯¢...';
                    
                    const result = await makeRequest(`/api/complaints/user/${userId.value}?page=1&size=10`);

                    if (result.success) {
                        const complaints = result.data || [];
                        complaintTestResult.value = `âœ… ç”¨æˆ·æŠ•è¯‰æŸ¥è¯¢æˆåŠŸ\nç”¨æˆ·ID: ${userId.value}\næŠ•è¯‰æ•°é‡: ${complaints.length}\n`;
                        
                        if (complaints.length > 0) {
                            complaintTestResult.value += `\nğŸ“‹ æŠ•è¯‰åˆ—è¡¨:\n`;
                            complaints.forEach((complaint, index) => {
                                complaintTestResult.value += `${index + 1}. æŠ•è¯‰æ ‡é¢˜: ${complaint.title}\n`;
                                complaintTestResult.value += `   çŠ¶æ€: ${complaint.status}\n`;
                                complaintTestResult.value += `   æŠ•è¯‰äººID: ${complaint.complainantId}\n`;
                                complaintTestResult.value += `   è¢«æŠ•è¯‰äººID: ${complaint.defendantId}\n\n`;
                            });
                        } else {
                            complaintTestResult.value += '\nğŸ“ æç¤º: è¯¥ç”¨æˆ·æš‚æ— æŠ•è¯‰è®°å½•';
                        }
                    } else {
                        complaintTestResult.value = `âŒ ç”¨æˆ·æŠ•è¯‰æŸ¥è¯¢å¤±è´¥: ${result.error || result.message}`;
                    }
                };

                // æµ‹è¯•åˆ›å»ºæŠ•è¯‰
                const testCreateComplaint = async () => {
                    complaintTestResult.value = 'ğŸ”„ æ­£åœ¨æµ‹è¯•åˆ›å»ºæŠ•è¯‰...';
                    
                    const complaintData = {
                        orderId: null, // ä¸å…³è”è®¢å•çš„æŠ•è¯‰
                        defendantId: 2, // å‡è®¾è¢«æŠ•è¯‰äººç”¨æˆ·IDä¸º2
                        complaintType: 'SERVICE',
                        title: 'æµ‹è¯•æŠ•è¯‰æ ‡é¢˜',
                        description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æŠ•è¯‰ï¼Œç”¨äºéªŒè¯æŠ•è¯‰åˆ›å»ºåŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚',
                        evidenceFiles: []
                    };

                    const result = await makeRequest(`/api/complaints/create?complainantId=${userId.value}`, {
                        method: 'POST',
                        body: JSON.stringify(complaintData)
                    });

                    if (result.success) {
                        complaintTestResult.value += `\nâœ… åˆ›å»ºæŠ•è¯‰æˆåŠŸ\næŠ•è¯‰ID: ${result.data}\næŠ•è¯‰äººç”¨æˆ·ID: ${userId.value}\nè¢«æŠ•è¯‰äººç”¨æˆ·ID: ${complaintData.defendantId}`;
                    } else {
                        complaintTestResult.value += `\nâŒ åˆ›å»ºæŠ•è¯‰å¤±è´¥: ${result.error || result.message}`;
                    }
                };

                // æµ‹è¯•æ•°æ®åº“å…³ç³»
                const testDatabaseRelations = () => {
                    dbTestResult.value = `ğŸ“Š æ•°æ®åº“å…³ç³»è¯´æ˜\n\n`;
                    dbTestResult.value += `ğŸ”— è¡¨å…³ç³»ç»“æ„:\n`;
                    dbTestResult.value += `1. users è¡¨ - å­˜å‚¨ç”¨æˆ·åŸºæœ¬ä¿¡æ¯\n`;
                    dbTestResult.value += `   â””â”€ id (ç”¨æˆ·ID)\n\n`;
                    dbTestResult.value += `2. passengers è¡¨ - å­˜å‚¨ä¹˜å®¢ä¿¡æ¯\n`;
                    dbTestResult.value += `   â”œâ”€ id (ä¹˜å®¢ID)\n`;
                    dbTestResult.value += `   â””â”€ user_id (å…³è”ç”¨æˆ·ID)\n\n`;
                    dbTestResult.value += `3. drivers è¡¨ - å­˜å‚¨å¸æœºä¿¡æ¯\n`;
                    dbTestResult.value += `   â”œâ”€ id (å¸æœºID)\n`;
                    dbTestResult.value += `   â””â”€ user_id (å…³è”ç”¨æˆ·ID)\n\n`;
                    dbTestResult.value += `4. orders è¡¨ - å­˜å‚¨è®¢å•ä¿¡æ¯\n`;
                    dbTestResult.value += `   â”œâ”€ passenger_id (å…³è”ä¹˜å®¢ID)\n`;
                    dbTestResult.value += `   â””â”€ driver_id (å…³è”å¸æœºID)\n\n`;
                    dbTestResult.value += `5. complaints è¡¨ - å­˜å‚¨æŠ•è¯‰ä¿¡æ¯\n`;
                    dbTestResult.value += `   â”œâ”€ complainant_id (æŠ•è¯‰äººç”¨æˆ·ID)\n`;
                    dbTestResult.value += `   â””â”€ defendant_id (è¢«æŠ•è¯‰äººç”¨æˆ·ID)\n\n`;
                    dbTestResult.value += `âœ… ä¿®å¤åçš„æŸ¥è¯¢é€»è¾‘:\n`;
                    dbTestResult.value += `- å‰ç«¯ä¼ é€’ç”¨æˆ·ID\n`;
                    dbTestResult.value += `- åç«¯é€šè¿‡ç”¨æˆ·IDæŸ¥æ‰¾ä¹˜å®¢ID\n`;
                    dbTestResult.value += `- ä½¿ç”¨ä¹˜å®¢IDæŸ¥è¯¢è®¢å•\n`;
                    dbTestResult.value += `- æŠ•è¯‰è¡¨ç›´æ¥ä½¿ç”¨ç”¨æˆ·ID`;
                };

                return {
                    userId,
                    orderTestResult,
                    complaintTestResult,
                    dbTestResult,
                    testPassengerOrders,
                    testUserComplaints,
                    testCreateComplaint,
                    testDatabaseRelations
                };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>