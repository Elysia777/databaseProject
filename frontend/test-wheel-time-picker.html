<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>滚轮时间选择器测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        .warning { background-color: #fff3cd; color: #856404; }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 3px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background-color: #0056b3; }
        .time-display {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin: 10px 0;
        }
        .feature-list {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>滚轮时间选择器功能测试</h1>

    <div class="test-section">
        <h3>🎯 新功能特点</h3>
        <div class="feature-list">
            <ul>
                <li>✅ 滚轮式选择日期、小时、分钟</li>
                <li>✅ 今天的时间只能从30分钟后开始选择</li>
                <li>✅ 分钟选择以15分钟为间隔（00, 15, 30, 45）</li>
                <li>✅ 支持未来7天的预约</li>
                <li>✅ 直观的"今天"、"明天"显示</li>
                <li>✅ 移动端友好的界面</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h3>🕐 当前时间信息</h3>
        <div id="currentTimeInfo" class="info"></div>
    </div>

    <div class="test-section">
        <h3>🧪 功能测试</h3>
        <button onclick="testTimeValidation()">测试时间验证逻辑</button>
        <button onclick="testDateGeneration()">测试日期生成</button>
        <button onclick="testHourGeneration()">测试小时生成</button>
        <button onclick="testMinuteGeneration()">测试分钟生成</button>
        <div id="testResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>📱 实际使用测试</h3>
        <p>请到乘客地图页面测试实际的时间选择器功能：</p>
        <ol>
            <li>切换到"预约单"模式</li>
            <li>点击"选择时间"按钮</li>
            <li>测试滚轮选择功能</li>
            <li>验证时间限制是否正确</li>
        </ol>
        <a href="/passenger-app.html" target="_blank">
            <button>打开乘客地图页面</button>
        </a>
    </div>

    <div class="test-section">
        <h3>📊 测试结果</h3>
        <div id="overallResult" class="result"></div>
    </div>

    <script>
        // 显示当前时间信息
        function updateCurrentTimeInfo() {
            const now = new Date();
            const minTime = new Date(now.getTime() + 30 * 60 * 1000);
            
            const info = `
                <strong>当前时间:</strong> ${now.toLocaleString()}<br>
                <strong>最早预约时间:</strong> ${minTime.toLocaleString()}<br>
                <strong>当前小时:</strong> ${now.getHours()}<br>
                <strong>当前分钟:</strong> ${now.getMinutes()}<br>
                <strong>30分钟后小时:</strong> ${minTime.getHours()}<br>
                <strong>30分钟后分钟:</strong> ${minTime.getMinutes()}
            `;
            
            document.getElementById('currentTimeInfo').innerHTML = info;
        }

        // 测试时间验证逻辑
        function testTimeValidation() {
            const resultDiv = document.getElementById('testResult');
            const now = new Date();
            
            // 测试用例
            const testCases = [
                {
                    name: '当前时间',
                    time: now,
                    shouldBeValid: false
                },
                {
                    name: '15分钟后',
                    time: new Date(now.getTime() + 15 * 60 * 1000),
                    shouldBeValid: false
                },
                {
                    name: '30分钟后',
                    time: new Date(now.getTime() + 30 * 60 * 1000),
                    shouldBeValid: true
                },
                {
                    name: '1小时后',
                    time: new Date(now.getTime() + 60 * 60 * 1000),
                    shouldBeValid: true
                },
                {
                    name: '8天后',
                    time: new Date(now.getTime() + 8 * 24 * 60 * 60 * 1000),
                    shouldBeValid: false
                }
            ];
            
            let html = '<div class="info"><strong>时间验证测试结果:</strong><br>';
            let passCount = 0;
            
            testCases.forEach(testCase => {
                const isValid = validateTime(testCase.time);
                const passed = isValid === testCase.shouldBeValid;
                const icon = passed ? '✅' : '❌';
                
                if (passed) passCount++;
                
                html += `${icon} ${testCase.name}: ${testCase.time.toLocaleString()} - ${isValid ? '有效' : '无效'}<br>`;
            });
            
            html += `<br><strong>通过率: ${passCount}/${testCases.length}</strong></div>`;
            resultDiv.innerHTML = html;
        }

        // 验证时间是否有效
        function validateTime(time) {
            const now = new Date();
            const minTime = new Date(now.getTime() + 30 * 60 * 1000);
            const maxTime = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
            
            return time >= minTime && time <= maxTime;
        }

        // 测试日期生成
        function testDateGeneration() {
            const resultDiv = document.getElementById('testResult');
            const now = new Date();
            
            let html = '<div class="info"><strong>日期生成测试:</strong><br>';
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(now);
                date.setDate(date.getDate() + i);
                
                let label;
                if (i === 0) {
                    label = '今天';
                } else if (i === 1) {
                    label = '明天';
                } else {
                    label = `${date.getMonth() + 1}月${date.getDate()}日`;
                }
                
                html += `第${i + 1}天: ${label} (${date.toDateString()})<br>`;
            }
            
            html += '</div>';
            resultDiv.innerHTML = html;
        }

        // 测试小时生成
        function testHourGeneration() {
            const resultDiv = document.getElementById('testResult');
            const now = new Date();
            
            let html = '<div class="info"><strong>小时生成测试:</strong><br>';
            
            // 测试今天的小时
            const minTime = new Date(now.getTime() + 30 * 60 * 1000);
            const startHour = minTime.getHours();
            
            html += `<strong>今天可选小时:</strong> `;
            for (let hour = startHour; hour <= 23; hour++) {
                html += `${hour}, `;
            }
            html += '<br>';
            
            // 测试明天的小时
            html += `<strong>明天可选小时:</strong> 0-23 (全天)<br>`;
            
            html += '</div>';
            resultDiv.innerHTML = html;
        }

        // 测试分钟生成
        function testMinuteGeneration() {
            const resultDiv = document.getElementById('testResult');
            const now = new Date();
            
            let html = '<div class="info"><strong>分钟生成测试:</strong><br>';
            
            // 测试今天当前小时的分钟
            const currentHour = now.getHours();
            const minTime = new Date(now.getTime() + 30 * 60 * 1000);
            
            if (currentHour === minTime.getHours()) {
                const startMinute = Math.ceil(minTime.getMinutes() / 15) * 15;
                html += `<strong>今天${currentHour}点可选分钟:</strong> `;
                for (let minute = startMinute; minute <= 45; minute += 15) {
                    html += `${minute}, `;
                }
                html += '<br>';
            }
            
            // 测试其他情况的分钟
            html += `<strong>其他时间可选分钟:</strong> 0, 15, 30, 45<br>`;
            
            html += '</div>';
            resultDiv.innerHTML = html;
        }

        // 页面加载时更新时间信息
        window.onload = function() {
            updateCurrentTimeInfo();
            
            // 每分钟更新一次时间信息
            setInterval(updateCurrentTimeInfo, 60000);
        };
    </script>
</body>
</html>