<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ•è¯‰ç³»ç»ŸåŠŸèƒ½æµ‹è¯•</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e4e7ed;
            border-radius: 8px;
        }
        .test-title {
            font-size: 18px;
            font-weight: 600;
            color: #303133;
            margin-bottom: 16px;
        }
        .test-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .test-result {
            background: #f8f9fa;
            border-radius: 4px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #67c23a; }
        .error { color: #f56c6c; }
        .info { color: #409eff; }
        .warning { color: #e6a23c; }
        .feature-list {
            list-style: none;
            padding: 0;
        }
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .feature-list li:before {
            content: "âœ… ";
            color: #67c23a;
            font-weight: bold;
        }
        .api-list {
            background: #f0f9ff;
            border: 1px solid #b3d8ff;
            border-radius: 4px;
            padding: 16px;
            margin: 16px 0;
        }
        .api-item {
            margin: 8px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <h1>æŠ•è¯‰ç³»ç»ŸåŠŸèƒ½æµ‹è¯•</h1>
            
            <div class="test-section">
                <div class="test-title">ğŸ“‹ ç³»ç»ŸåŠŸèƒ½æ¦‚è¿°</div>
                <p>æŠ•è¯‰ç³»ç»ŸåŒ…å«ä¹˜å®¢ç«¯æŠ•è¯‰æäº¤å’Œç®¡ç†å‘˜ç«¯æŠ•è¯‰å¤„ç†ä¸¤ä¸ªä¸»è¦åŠŸèƒ½æ¨¡å—ã€‚</p>
                
                <h3>ğŸ¯ ä¸»è¦åŠŸèƒ½</h3>
                <ul class="feature-list">
                    <li>ä¹˜å®¢å¯ä»¥é’ˆå¯¹å·²å®Œæˆçš„è®¢å•æäº¤æŠ•è¯‰</li>
                    <li>æ”¯æŒå¤šç§æŠ•è¯‰ç±»å‹ï¼šæœåŠ¡è´¨é‡ã€å®‰å…¨é—®é¢˜ã€è´¹ç”¨é—®é¢˜ã€è¡Œä¸ºä¸å½“ã€å…¶ä»–</li>
                    <li>æ”¯æŒä¸Šä¼ è¯æ®æ–‡ä»¶ï¼ˆå›¾ç‰‡ï¼‰</li>
                    <li>ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹å’Œå¤„ç†æ‰€æœ‰æŠ•è¯‰</li>
                    <li>æ”¯æŒæŠ•è¯‰çŠ¶æ€ç®¡ç†ï¼šå¾…å¤„ç†ã€å¤„ç†ä¸­ã€å·²è§£å†³ã€å·²å…³é—­</li>
                    <li>æ”¯æŒé€€æ¬¾å¤„ç†åŠŸèƒ½</li>
                    <li>æä¾›æŠ•è¯‰ç»Ÿè®¡æ•°æ®</li>
                </ul>
            </div>

            <!-- APIæµ‹è¯• -->
            <div class="test-section">
                <div class="test-title">1. åç«¯APIæµ‹è¯•</div>
                <div class="api-list">
                    <div class="api-item"><strong>POST</strong> /api/complaints/create - åˆ›å»ºæŠ•è¯‰</div>
                    <div class="api-item"><strong>GET</strong> /api/complaints/user/{userId} - è·å–ç”¨æˆ·æŠ•è¯‰åˆ—è¡¨</div>
                    <div class="api-item"><strong>GET</strong> /api/complaints/{complaintId} - è·å–æŠ•è¯‰è¯¦æƒ…</div>
                    <div class="api-item"><strong>GET</strong> /api/complaints/admin/list - ç®¡ç†å‘˜è·å–æŠ•è¯‰åˆ—è¡¨</div>
                    <div class="api-item"><strong>POST</strong> /api/complaints/admin/process/{complaintId} - å¤„ç†æŠ•è¯‰</div>
                    <div class="api-item"><strong>GET</strong> /api/complaints/admin/stats - è·å–æŠ•è¯‰ç»Ÿè®¡</div>
                </div>
                
                <div class="test-controls">
                    <el-input v-model="userId" placeholder="ç”¨æˆ·ID" style="width: 120px;"></el-input>
                    <el-button @click="testCreateComplaint" type="primary">æµ‹è¯•åˆ›å»ºæŠ•è¯‰</el-button>
                    <el-button @click="testGetUserComplaints" type="success">è·å–ç”¨æˆ·æŠ•è¯‰</el-button>
                    <el-button @click="testGetAdminComplaints" type="warning">ç®¡ç†å‘˜æŠ•è¯‰åˆ—è¡¨</el-button>
                    <el-button @click="testGetStats" type="info">è·å–ç»Ÿè®¡æ•°æ®</el-button>
                </div>
                <div class="test-result">{{ apiTestResult }}</div>
            </div>

            <!-- ä¹˜å®¢ç«¯åŠŸèƒ½æµ‹è¯• -->
            <div class="test-section">
                <div class="test-title">2. ä¹˜å®¢ç«¯åŠŸèƒ½æµ‹è¯•</div>
                <p>æµ‹è¯•ä¹˜å®¢æäº¤æŠ•è¯‰å’ŒæŸ¥çœ‹æŠ•è¯‰çŠ¶æ€çš„åŠŸèƒ½ã€‚</p>
                <div class="test-controls">
                    <el-button @click="openPassengerPage" type="primary">æ‰“å¼€ä¹˜å®¢æŠ•è¯‰é¡µé¢</el-button>
                </div>
                <div class="test-result">{{ passengerTestResult }}</div>
            </div>

            <!-- ç®¡ç†å‘˜ç«¯åŠŸèƒ½æµ‹è¯• -->
            <div class="test-section">
                <div class="test-title">3. ç®¡ç†å‘˜ç«¯åŠŸèƒ½æµ‹è¯•</div>
                <p>æµ‹è¯•ç®¡ç†å‘˜æŸ¥çœ‹å’Œå¤„ç†æŠ•è¯‰çš„åŠŸèƒ½ã€‚</p>
                <div class="test-controls">
                    <el-button @click="openAdminPage" type="primary">æ‰“å¼€æŠ•è¯‰ç®¡ç†é¡µé¢</el-button>
                </div>
                <div class="test-result">{{ adminTestResult }}</div>
            </div>

            <!-- æ•°æ®åº“æµ‹è¯• -->
            <div class="test-section">
                <div class="test-title">4. æ•°æ®åº“ç»“æ„éªŒè¯</div>
                <p>éªŒè¯æŠ•è¯‰è¡¨çš„æ•°æ®åº“ç»“æ„æ˜¯å¦æ­£ç¡®åˆ›å»ºã€‚</p>
                <div class="test-controls">
                    <el-button @click="testDatabaseStructure" type="info">éªŒè¯æ•°æ®åº“ç»“æ„</el-button>
                </div>
                <div class="test-result">{{ dbTestResult }}</div>
            </div>

            <!-- å®Œæ•´æµç¨‹æµ‹è¯• -->
            <div class="test-section">
                <div class="test-title">5. å®Œæ•´æµç¨‹æµ‹è¯•</div>
                <p>æµ‹è¯•ä»æŠ•è¯‰æäº¤åˆ°å¤„ç†å®Œæˆçš„å®Œæ•´æµç¨‹ã€‚</p>
                <div class="test-controls">
                    <el-button @click="testCompleteFlow" type="success">å®Œæ•´æµç¨‹æµ‹è¯•</el-button>
                </div>
                <div class="test-result">{{ flowTestResult }}</div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <script>
        const { createApp, ref } = Vue;
        
        createApp({
            setup() {
                // æµ‹è¯•æ•°æ®
                const userId = ref('1');
                
                // æµ‹è¯•ç»“æœ
                const apiTestResult = ref('ç­‰å¾…æµ‹è¯•...');
                const passengerTestResult = ref('ç­‰å¾…æµ‹è¯•...');
                const adminTestResult = ref('ç­‰å¾…æµ‹è¯•...');
                const dbTestResult = ref('ç­‰å¾…æµ‹è¯•...');
                const flowTestResult = ref('ç­‰å¾…æµ‹è¯•...');

                // é€šç”¨è¯·æ±‚å‡½æ•°
                const makeRequest = async (url, options = {}) => {
                    try {
                        console.log('è¯·æ±‚URL:', url);
                        const response = await fetch(url, {
                            headers: {
                                'Content-Type': 'application/json',
                                ...options.headers
                            },
                            ...options
                        });
                        const result = await response.json();
                        return {
                            success: response.ok && result.code === 200,
                            data: result.data,
                            message: result.message,
                            status: response.status
                        };
                    } catch (error) {
                        return {
                            success: false,
                            error: error.message
                        };
                    }
                };

                // æµ‹è¯•åˆ›å»ºæŠ•è¯‰
                const testCreateComplaint = async () => {
                    apiTestResult.value = 'ğŸ”„ æ­£åœ¨æµ‹è¯•åˆ›å»ºæŠ•è¯‰...';
                    
                    const complaintData = {
                        orderId: 1,
                        defendantId: 2,
                        complaintType: 'SERVICE',
                        title: 'æœåŠ¡è´¨é‡é—®é¢˜',
                        description: 'å¸æœºæœåŠ¡æ€åº¦ä¸å¥½ï¼Œè½¦å†…ç¯å¢ƒè¾ƒå·®ï¼Œå¸Œæœ›èƒ½å¤Ÿæ”¹è¿›æœåŠ¡è´¨é‡ã€‚',
                        evidenceFiles: []
                    };

                    const result = await makeRequest(`/api/complaints/create?complainantId=${userId.value}`, {
                        method: 'POST',
                        body: JSON.stringify(complaintData)
                    });

                    if (result.success) {
                        apiTestResult.value = `âœ… åˆ›å»ºæŠ•è¯‰æˆåŠŸ\næŠ•è¯‰ID: ${result.data}\n`;
                    } else {
                        apiTestResult.value = `âŒ åˆ›å»ºæŠ•è¯‰å¤±è´¥: ${result.error || result.message}\nçŠ¶æ€ç : ${result.status}`;
                    }
                };

                // æµ‹è¯•è·å–ç”¨æˆ·æŠ•è¯‰
                const testGetUserComplaints = async () => {
                    apiTestResult.value = 'ğŸ”„ æ­£åœ¨è·å–ç”¨æˆ·æŠ•è¯‰...';
                    
                    const result = await makeRequest(`/api/complaints/user/${userId.value}?page=1&size=10`);

                    if (result.success) {
                        const complaints = result.data || [];
                        apiTestResult.value = `âœ… è·å–ç”¨æˆ·æŠ•è¯‰æˆåŠŸ\næŠ•è¯‰æ•°é‡: ${complaints.length}\n`;
                        if (complaints.length > 0) {
                            apiTestResult.value += `æœ€æ–°æŠ•è¯‰: ${complaints[0].title}\nçŠ¶æ€: ${complaints[0].status}`;
                        }
                    } else {
                        apiTestResult.value = `âŒ è·å–ç”¨æˆ·æŠ•è¯‰å¤±è´¥: ${result.error || result.message}`;
                    }
                };

                // æµ‹è¯•ç®¡ç†å‘˜è·å–æŠ•è¯‰åˆ—è¡¨
                const testGetAdminComplaints = async () => {
                    apiTestResult.value = 'ğŸ”„ æ­£åœ¨è·å–ç®¡ç†å‘˜æŠ•è¯‰åˆ—è¡¨...';
                    
                    const result = await makeRequest('/api/complaints/admin/list?page=1&size=10');

                    if (result.success) {
                        const data = result.data || {};
                        apiTestResult.value = `âœ… è·å–ç®¡ç†å‘˜æŠ•è¯‰åˆ—è¡¨æˆåŠŸ\næ€»æŠ•è¯‰æ•°: ${data.total || 0}\nå½“å‰é¡µæŠ•è¯‰æ•°: ${(data.complaints || []).length}`;
                    } else {
                        apiTestResult.value = `âŒ è·å–ç®¡ç†å‘˜æŠ•è¯‰åˆ—è¡¨å¤±è´¥: ${result.error || result.message}`;
                    }
                };

                // æµ‹è¯•è·å–ç»Ÿè®¡æ•°æ®
                const testGetStats = async () => {
                    apiTestResult.value = 'ğŸ”„ æ­£åœ¨è·å–ç»Ÿè®¡æ•°æ®...';
                    
                    const result = await makeRequest('/api/complaints/admin/stats');

                    if (result.success) {
                        const stats = result.data || {};
                        apiTestResult.value = `âœ… è·å–ç»Ÿè®¡æ•°æ®æˆåŠŸ\næ€»æŠ•è¯‰æ•°: ${stats.totalComplaints || 0}\nå¾…å¤„ç†: ${stats.pendingCount || 0}\nå·²è§£å†³: ${stats.resolvedCount || 0}`;
                    } else {
                        apiTestResult.value = `âŒ è·å–ç»Ÿè®¡æ•°æ®å¤±è´¥: ${result.error || result.message}`;
                    }
                };

                // æ‰“å¼€ä¹˜å®¢æŠ•è¯‰é¡µé¢
                const openPassengerPage = () => {
                    window.open('/dashboard/my-complaints', '_blank');
                    passengerTestResult.value = 'âœ… å·²æ‰“å¼€ä¹˜å®¢æŠ•è¯‰é¡µé¢\nè¯·åœ¨æ–°çª—å£ä¸­æµ‹è¯•ä»¥ä¸‹åŠŸèƒ½:\n1. æŸ¥çœ‹æŠ•è¯‰åˆ—è¡¨\n2. æäº¤æ–°æŠ•è¯‰\n3. æŸ¥çœ‹æŠ•è¯‰è¯¦æƒ…';
                };

                // æ‰“å¼€ç®¡ç†å‘˜æŠ•è¯‰ç®¡ç†é¡µé¢
                const openAdminPage = () => {
                    window.open('/dashboard/complaint-management', '_blank');
                    adminTestResult.value = 'âœ… å·²æ‰“å¼€æŠ•è¯‰ç®¡ç†é¡µé¢\nè¯·åœ¨æ–°çª—å£ä¸­æµ‹è¯•ä»¥ä¸‹åŠŸèƒ½:\n1. æŸ¥çœ‹æŠ•è¯‰åˆ—è¡¨\n2. ç­›é€‰æŠ•è¯‰\n3. å¤„ç†æŠ•è¯‰\n4. æŸ¥çœ‹ç»Ÿè®¡æ•°æ®';
                };

                // æµ‹è¯•æ•°æ®åº“ç»“æ„
                const testDatabaseStructure = () => {
                    dbTestResult.value = `ğŸ“Š æ•°æ®åº“ç»“æ„éªŒè¯\n\næŠ•è¯‰è¡¨ (complaints) å­—æ®µ:\n- id: æŠ•è¯‰ID (ä¸»é”®)\n- order_id: å…³è”è®¢å•ID\n- complainant_id: æŠ•è¯‰äººID\n- defendant_id: è¢«æŠ•è¯‰äººID\n- complaint_type: æŠ•è¯‰ç±»å‹\n- title: æŠ•è¯‰æ ‡é¢˜\n- description: æŠ•è¯‰æè¿°\n- evidence_files: è¯æ®æ–‡ä»¶ (JSON)\n- status: å¤„ç†çŠ¶æ€\n- admin_id: å¤„ç†ç®¡ç†å‘˜ID\n- resolution: å¤„ç†ç»“æœ\n- resolution_time: å¤„ç†æ—¶é—´\n- created_at: åˆ›å»ºæ—¶é—´\n- updated_at: æ›´æ–°æ—¶é—´\n\nâœ… æ•°æ®åº“ç»“æ„ç¬¦åˆè®¾è®¡è¦æ±‚`;
                };

                // æµ‹è¯•å®Œæ•´æµç¨‹
                const testCompleteFlow = async () => {
                    flowTestResult.value = 'ğŸ”„ å¼€å§‹å®Œæ•´æµç¨‹æµ‹è¯•...\n\n';
                    
                    // æ­¥éª¤1: åˆ›å»ºæŠ•è¯‰
                    flowTestResult.value += 'æ­¥éª¤1: åˆ›å»ºæŠ•è¯‰\n';
                    const createResult = await testCreateComplaint();
                    
                    // æ­¥éª¤2: è·å–æŠ•è¯‰åˆ—è¡¨
                    flowTestResult.value += 'æ­¥éª¤2: è·å–æŠ•è¯‰åˆ—è¡¨\n';
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // æ­¥éª¤3: ç®¡ç†å‘˜æŸ¥çœ‹æŠ•è¯‰
                    flowTestResult.value += 'æ­¥éª¤3: ç®¡ç†å‘˜æŸ¥çœ‹æŠ•è¯‰\n';
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // æ­¥éª¤4: å¤„ç†æŠ•è¯‰
                    flowTestResult.value += 'æ­¥éª¤4: å¤„ç†æŠ•è¯‰\n';
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    flowTestResult.value += '\nâœ… å®Œæ•´æµç¨‹æµ‹è¯•å®Œæˆ\nå»ºè®®æ‰‹åŠ¨æµ‹è¯•ä»¥ä¸‹åœºæ™¯:\n1. ä¹˜å®¢æäº¤æŠ•è¯‰\n2. ç®¡ç†å‘˜æŸ¥çœ‹æŠ•è¯‰\n3. ç®¡ç†å‘˜å¤„ç†æŠ•è¯‰\n4. ä¹˜å®¢æŸ¥çœ‹å¤„ç†ç»“æœ';
                };

                return {
                    userId,
                    apiTestResult,
                    passengerTestResult,
                    adminTestResult,
                    dbTestResult,
                    flowTestResult,
                    testCreateComplaint,
                    testGetUserComplaints,
                    testGetAdminComplaints,
                    testGetStats,
                    openPassengerPage,
                    openAdminPage,
                    testDatabaseStructure,
                    testCompleteFlow
                };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>