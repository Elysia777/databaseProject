<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>司机端地图交互功能测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-section {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }
        .step {
            background: #f8f9fa;
            padding: 10px;
            margin: 8px 0;
            border-left: 4px solid #007bff;
            border-radius: 4px;
        }
        .expected {
            background: #d4edda;
            border-left-color: #28a745;
        }
        .warning {
            background: #fff3cd;
            border-left-color: #ffc107;
            color: #856404;
        }
        .error {
            background: #f8d7da;
            border-left-color: #dc3545;
            color: #721c24;
        }
        .success {
            background: #d1ecf1;
            border-left-color: #17a2b8;
            color: #0c5460;
        }
        .code {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border: 1px solid #e9ecef;
            margin: 10px 0;
        }
        .debug-info {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
        }
        .debug-info h4 {
            margin-top: 0;
            color: #0066cc;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background-color: #28a745; }
        .status-error { background-color: #dc3545; }
        .status-info { background-color: #17a2b8; }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🗺️ 司机端地图交互功能测试</h1>
        <p>测试司机端地图的拖拽、缩放等交互功能是否正常工作。</p>
    </div>

    <div class="container">
        <div class="test-section">
            <h3>📋 修复的问题</h3>
            <div class="step success">
                <strong>1. 启用了地图交互功能</strong>
                <div class="code">
map = new window.AMap.Map('driverMapContainer', {
  resizeEnable: true,        // 启用地图自适应
  dragEnable: true,          // 启用拖拽 ⭐
  zoomEnable: true,          // 启用缩放 ⭐
  doubleClickZoom: true,     // 启用双击缩放 ⭐
  keyboardEnable: true,      // 启用键盘操作
  scrollWheel: true,         // 启用滚轮缩放 ⭐
  touchZoom: true,           // 启用触摸缩放 ⭐
  rotateEnable: false,       // 禁用旋转（避免误操作）
  pitchEnable: false,        // 禁用倾斜（保持2D视图）
})
                </div>
            </div>
            
            <div class="step success">
                <strong>2. 优化了CSS样式</strong>
                <div class="code">
#driverMapContainer {
  width: 100%;
  height: 100%;
  pointer-events: auto;      // 确保可以接收交互事件
  touch-action: none;        // 防止移动端手势干扰
}
                </div>
            </div>
            
            <div class="step success">
                <strong>3. 添加了调试功能</strong>
                <div class="code">
// 暴露到全局的调试函数
window.testMapInteraction()  // 测试地图交互状态
window.driverMap            // 地图对象引用
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="test-section">
            <h3>🧪 测试步骤</h3>
            
            <div class="step">
                <span class="status-indicator status-info"></span>
                <strong>步骤 1：</strong>打开司机端地图页面
                <div class="code">
1. 访问司机端地图页面
2. 等待地图完全加载
3. 观察控制台日志确认地图初始化成功
                </div>
            </div>

            <div class="step">
                <span class="status-indicator status-info"></span>
                <strong>步骤 2：</strong>测试拖拽功能
                <div class="code">
1. 在地图上按住鼠标左键
2. 拖拽地图到不同位置
3. 观察控制台是否输出拖拽日志
4. 确认地图视野确实发生了移动
                </div>
            </div>

            <div class="step">
                <span class="status-indicator status-info"></span>
                <strong>步骤 3：</strong>测试缩放功能
                <div class="code">
1. 使用鼠标滚轮在地图上滚动
2. 双击地图进行缩放
3. 观察控制台的缩放级别日志
4. 确认地图确实放大或缩小了
                </div>
            </div>

            <div class="step">
                <span class="status-indicator status-info"></span>
                <strong>步骤 4：</strong>运行调试命令
                <div class="code">
在浏览器控制台运行以下命令：
window.testMapInteraction()

期望输出：
{
  dragEnable: true,
  zoomEnable: true,
  scrollWheel: true,
  doubleClickZoom: true,
  zoom: 16,
  center: {...}
}
                </div>
            </div>

            <div class="step expected">
                <span class="status-indicator status-success"></span>
                <strong>步骤 5：</strong>验证交互功能正常
                <div class="code">
<strong>期望结果：</strong>
✅ 可以拖拽地图移动视野
✅ 可以使用滚轮缩放地图
✅ 可以双击地图进行缩放
✅ 控制台显示相应的交互日志
✅ testMapInteraction()返回所有功能都为true
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="test-section">
            <h3>🔍 调试信息</h3>
            
            <div class="debug-info">
                <h4>控制台关键日志</h4>
                <div class="code">
<strong>地图初始化：</strong>
- "🗺️ 初始化司机端地图，启用所有交互功能..."
- "✅ 司机端地图创建成功，交互功能已启用"
- "✅ 司机端地图加载完成"
- "🔧 地图对象已暴露到 window.driverMap"

<strong>交互事件：</strong>
- "🖱️ 开始拖拽地图"
- "🖱️ 结束拖拽地图"
- "🔍 地图缩放级别: 17"
- "🖱️ 点击地图: 116.123, 39.456"
                </div>
            </div>

            <div class="debug-info">
                <h4>调试命令</h4>
                <div class="code">
<strong>测试地图交互状态：</strong>
window.testMapInteraction()

<strong>手动设置地图中心：</strong>
window.driverMap.setCenter([116.397428, 39.90923])

<strong>手动设置缩放级别：</strong>
window.driverMap.setZoom(18)

<strong>获取当前地图状态：</strong>
window.driverMap.getStatus()
                </div>
            </div>

            <div class="debug-info">
                <h4>故障排除</h4>
                <div class="step error">
                    <strong>如果拖拽不工作：</strong>
                    <ul>
                        <li>检查dragEnable是否为true</li>
                        <li>确认没有其他元素覆盖地图</li>
                        <li>检查CSS的pointer-events设置</li>
                        <li>验证地图容器的z-index层级</li>
                    </ul>
                </div>
                <div class="step error">
                    <strong>如果缩放不工作：</strong>
                    <ul>
                        <li>检查zoomEnable和scrollWheel是否为true</li>
                        <li>确认浏览器没有禁用滚轮事件</li>
                        <li>检查touch-action CSS属性</li>
                        <li>验证双击缩放功能</li>
                    </ul>
                </div>
                <div class="step error">
                    <strong>如果移动端不工作：</strong>
                    <ul>
                        <li>检查touchZoom是否为true</li>
                        <li>确认touch-action: none设置</li>
                        <li>验证移动端手势识别</li>
                        <li>检查viewport设置</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="test-section">
            <h3>🎯 交互功能说明</h3>
            
            <div class="step success">
                <strong>拖拽功能 (dragEnable: true)</strong>
                <p>允许用户通过鼠标拖拽或触摸滑动来移动地图视野</p>
            </div>
            
            <div class="step success">
                <strong>缩放功能 (zoomEnable: true)</strong>
                <p>允许用户通过各种方式缩放地图：滚轮、双击、触摸手势</p>
            </div>
            
            <div class="step success">
                <strong>滚轮缩放 (scrollWheel: true)</strong>
                <p>允许用户使用鼠标滚轮进行地图缩放操作</p>
            </div>
            
            <div class="step success">
                <strong>双击缩放 (doubleClickZoom: true)</strong>
                <p>允许用户双击地图进行放大操作</p>
            </div>
            
            <div class="step success">
                <strong>触摸缩放 (touchZoom: true)</strong>
                <p>允许移动端用户使用双指手势进行缩放操作</p>
            </div>
            
            <div class="step warning">
                <strong>禁用的功能</strong>
                <p>rotateEnable: false - 禁用旋转避免误操作<br>
                   pitchEnable: false - 禁用倾斜保持2D视图</p>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="test-section success">
            <h3>✅ 测试完成标准</h3>
            <div class="step expected">
                <strong>基本交互功能：</strong>
                <ul>
                    <li>✅ 地图可以正常拖拽移动</li>
                    <li>✅ 滚轮缩放功能正常</li>
                    <li>✅ 双击缩放功能正常</li>
                    <li>✅ 移动端触摸操作正常</li>
                </ul>
            </div>
            <div class="step expected">
                <strong>调试功能：</strong>
                <ul>
                    <li>✅ 控制台显示交互事件日志</li>
                    <li>✅ testMapInteraction()函数正常工作</li>
                    <li>✅ 地图对象正确暴露到全局</li>
                    <li>✅ 所有交互状态都为true</li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>