<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®åº“çŠ¶æ€å­—æ®µä¿®å¤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .alert {
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .alert-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .sql-code {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .step {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>æ•°æ®åº“çŠ¶æ€å­—æ®µä¿®å¤æŒ‡å—</h1>

    <div class="alert alert-error">
        <h3>ğŸš¨ é—®é¢˜æè¿°</h3>
        <p>åˆ›å»ºé¢„çº¦å•æ—¶å‡ºç°é”™è¯¯ï¼š<code>Data truncated for column 'status' at row 1</code></p>
        <p>è¿™æ˜¯å› ä¸ºæ•°æ®åº“ä¸­çš„ <code>orders</code> è¡¨çš„ <code>status</code> å­—æ®µæ˜¯ ENUM ç±»å‹ï¼Œä¸åŒ…å« <code>SCHEDULED</code> çŠ¶æ€ã€‚</p>
    </div>

    <div class="alert alert-warning">
        <h3>âš ï¸ éœ€è¦æ‰‹åŠ¨æ‰§è¡Œ</h3>
        <p>ç”±äºå®‰å…¨åŸå› ï¼Œéœ€è¦ä½ æ‰‹åŠ¨åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œä»¥ä¸‹SQLè¯­å¥æ¥ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚</p>
    </div>

    <div class="step">
        <h3>æ­¥éª¤ 1: è¿æ¥æ•°æ®åº“</h3>
        <p>ä½¿ç”¨ä½ çš„æ•°æ®åº“ç®¡ç†å·¥å…·ï¼ˆå¦‚ MySQL Workbenchã€phpMyAdminã€æˆ–å‘½ä»¤è¡Œï¼‰è¿æ¥åˆ°æ•°æ®åº“ã€‚</p>
    </div>

    <div class="step">
        <h3>æ­¥éª¤ 2: æ‰§è¡Œä¿®å¤SQL</h3>
        <p>å¤åˆ¶å¹¶æ‰§è¡Œä»¥ä¸‹SQLè¯­å¥ï¼š</p>
        <div class="sql-code">-- ä¿®å¤ordersè¡¨çš„statuså­—æ®µï¼Œæ·»åŠ SCHEDULEDçŠ¶æ€

-- ä½¿ç”¨æ­£ç¡®çš„æ•°æ®åº“ï¼ˆæ ¹æ®ä½ çš„é…ç½®å¯èƒ½æ˜¯ taxi_system æˆ– taxi_operation_systemï¼‰
USE taxi_system;

-- æŸ¥çœ‹å½“å‰è¡¨ç»“æ„
DESCRIBE orders;

-- ä¿®æ”¹statuså­—æ®µï¼Œæ·»åŠ SCHEDULEDçŠ¶æ€åˆ°ENUMä¸­
ALTER TABLE orders MODIFY COLUMN status 
ENUM('PENDING', 'ASSIGNED', 'PICKUP', 'IN_PROGRESS', 'COMPLETED', 'CANCELLED', 'SCHEDULED') 
DEFAULT 'PENDING' 
COMMENT 'è®¢å•çŠ¶æ€ï¼šå¾…åˆ†é…ã€å·²åˆ†é…ã€æ¥å®¢ä¸­ã€è¿›è¡Œä¸­ã€å·²å®Œæˆã€å·²å–æ¶ˆã€å·²é¢„çº¦';

-- éªŒè¯ä¿®æ”¹ç»“æœ
DESCRIBE orders;</div>
    </div>

    <div class="step">
        <h3>æ­¥éª¤ 3: éªŒè¯ä¿®å¤</h3>
        <p>æ‰§è¡Œå®ŒSQLåï¼Œç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•é¢„çº¦å•åˆ›å»ºï¼š</p>
        <button onclick="testScheduledOrderCreation()">æµ‹è¯•é¢„çº¦å•åˆ›å»º</button>
        <div id="testResult"></div>
    </div>

    <div class="alert alert-info">
        <h3>ğŸ’¡ å¦‚æœæ•°æ®åº“åç§°ä¸å¯¹</h3>
        <p>å¦‚æœä¸Šé¢çš„SQLæ‰§è¡Œå¤±è´¥ï¼Œå¯èƒ½æ˜¯æ•°æ®åº“åç§°ä¸å¯¹ã€‚è¯·å°è¯•ï¼š</p>
        <ul>
            <li><code>USE taxi_operation_system;</code></li>
            <li>æˆ–è€…å…ˆæ‰§è¡Œ <code>SHOW DATABASES;</code> æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“åç§°</li>
        </ul>
    </div>

    <script>
        async function testScheduledOrderCreation() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = '<div style="color: blue;">ğŸ”„ æ­£åœ¨æµ‹è¯•é¢„çº¦å•åˆ›å»º...</div>';

            // åˆ›å»º1å°æ—¶åçš„é¢„çº¦å•
            const scheduledTime = new Date();
            scheduledTime.setHours(scheduledTime.getHours() + 1);
            scheduledTime.setMinutes(0);
            scheduledTime.setSeconds(0);
            
            const orderData = {
                passengerId: 1,
                pickupAddress: "æµ‹è¯•ä¸Šè½¦åœ°å€",
                pickupLatitude: 38.914677,
                pickupLongitude: 121.619643,
                destinationAddress: "æµ‹è¯•ç›®çš„åœ°",
                destinationLatitude: 38.924677,
                destinationLongitude: 121.629643,
                scheduledTime: formatDateTime(scheduledTime),
                estimatedFare: 25.00
            };
            
            try {
                const response = await fetch('/api/orders/scheduled', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(orderData)
                });
                
                const result = await response.json();
                
                if (response.ok && result.code === 200) {
                    resultDiv.innerHTML = `
                        <div style="color: green; margin-top: 10px;">
                            âœ… é¢„çº¦å•åˆ›å»ºæˆåŠŸï¼æ•°æ®åº“ä¿®å¤å®Œæˆã€‚<br>
                            è®¢å•ID: ${result.data.id}<br>
                            çŠ¶æ€: ${result.data.status}<br>
                            é¢„çº¦æ—¶é—´: ${result.data.scheduledTime}
                        </div>`;
                } else {
                    resultDiv.innerHTML = `
                        <div style="color: red; margin-top: 10px;">
                            âŒ é¢„çº¦å•åˆ›å»ºä»ç„¶å¤±è´¥: ${result.message}<br>
                            è¯·æ£€æŸ¥SQLæ˜¯å¦æ­£ç¡®æ‰§è¡Œï¼Œæˆ–è€…æ•°æ®åº“åç§°æ˜¯å¦æ­£ç¡®ã€‚
                        </div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div style="color: red; margin-top: 10px;">
                        âŒ ç½‘ç»œé”™è¯¯: ${error.message}
                    </div>`;
            }
        }

        function formatDateTime(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }
    </script>
</body>
</html>